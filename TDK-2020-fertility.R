
library(timeSeries)
library(tseries)
library(forecast)
library(ggplot2)
library(mFilter)
library(MTS)
library(readxl)
library(writexl) 
library(vars)
library(rms)
library(car)
library(broom)
library(urca)
library(fUnitRoots)
library(knitr)
library(scales)
library(tidyr)
library(dplyr)
library(ggpmisc)
library(naniar)
library(tsDyn)
library(data.table)
library(formattable)
library(readxl)
library(DT)
library(rio)
library(sparkline)
library(ggthemes)
library(kableExtra)


LiveBirthAndFertility <- tibble::tribble(
  ~Year, ~LiveBirthTotal, ~LiveBirthTo1000,  ~TotalFertility,
  1960,          146461,             14.7, 2.02086206906055,
  1961,          140365,               14,  1.9355344892408,
  1962,          130053,             12.9, 1.79080897445193,
  1963,          132335,             13.1, 1.81925745877228,
  1964,          132141,             13.1, 1.81413710242022,
  1965,          133009,             13.1,  1.8207747494822,
  1966,          138489,             13.6, 1.88570992660369,
  1967,          148886,             14.6,  2.0103364704776,
  1968,          154419,             15.1,  2.0618222124507,
  1969,          154318,               15, 2.03132952376522,
  1970,          151819,             14.7, 1.97666097689818,
  1971,          150640,             14.5, 1.92706722767208,
  1972,          153265,             14.7, 1.92483365370824,
  1973,          156224,               15,  1.9265288509902,
  1974,          186288,             17.8, 2.26892971019873,
  1975,          194240,             18.4, 2.34482361911766,
  1976,          185405,             17.5, 2.23064230047904,
  1977,          177574,             16.7, 2.15029213202397,
  1978,          168160,             15.8, 2.06219687071119,
  1979,          160364,               15,  2.0032193630849,
  1980,          148673,             13.9,  1.9091963252706,
  1981,          142890,             13.4, 1.87296989396942,
  1982,          133559,             12.5, 1.79212012301419,
  1983,          127258,             11.9, 1.74362489275741,
  1984,          125359,             11.8, 1.75162154212694,
  1985,          130200,             12.3, 1.84559344863437,
  1986,          128204,             12.2, 1.83588887443234,
  1987,          125840,               12, 1.81753637860205,
  1988,          124296,             11.9,  1.8060670138752,
  1989,          123304,             11.9, 1.79587348556755,
  1990,          125679,             12.1, 1.86545439558239,
  1991,          127207,             12.3, 1.87526026705402,
  1992,          121724,             11.7, 1.77665710985756,
  1993,          117033,             11.3, 1.68788129200799,
  1994,          115598,             11.2, 1.64249547981521,
  1995,          112054,             10.8, 1.57161109642861,
  1996,          105272,             10.2, 1.45746699301388,
  1997,          100350,              9.8, 1.37585704287392,
  1998,           97301,              9.5, 1.32473273961768,
  1999,           94645,              9.2,  1.2828856446462,
  2000,           97597,              9.6, 1.32085066412531,
  2001,           97047,              9.5, 1.30686858341398,
  2002,           96804,              9.5, 1.30109090416027,
  2003,           94647,              9.3, 1.26981243533056,
  2004,           95137,              9.4, 1.27426988787477,
  2005,           97496,              9.7, 1.30433780665119,
  2006,           99871,              9.9, 1.33830823757769,
  2007,           97613,              9.7, 1.31389187241381,
  2008,           99149, 9.87718102111656, 1.34552232706819,
  2009,           96442,   9.622405732137, 1.31928340718034,
  2010,           90335, 9.03347922299779,  1.2481858667316,
  2011,           88049, 8.82986511914461,  1.2314943968136,
  2012,           90269, 9.09936598580606, 1.33561788411806,
  2013,           88689, 8.96474975971845, 1.33798920015003,
  2014,           91510, 9.27484891249837, 1.40994722348349,
  2015,           91690, 9.31522291717549, 1.43887378641086,
  2016,           93063, 9.48265558374991, 1.49353236117606,
  2017,           91577, 9.35608072198044, 1.49397789402756,
  2018,           89807,  9.1868872827638, 1.48505184135328
) %>% data.frame()

Input <- data.frame(
  Year = c(1960,1961,1962,1963,1964,
           1965,1966,1967,1968,1969,1970,1971,1972,1973,
           1974,1975,1976,1977,1978,1979,1980,1981,1982,
           1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,
           1993,1994,1995,1996,1997,1998,1999,2000,2001,
           2002,2003,2004,2005,2006,2007,2008,2009,2010,
           2011,2012,2013,2014,2015,2016,2017),
  Activs = c(4735,4626,4544,4569,4653,
             4649,4666,4710,4802,4979,5127,5440,5491,5531,
             5563,5634,5679,5777,5742,5736,5470,5447,5437,
             5413,5392,5373,5361,5371,5284,5216,5108,5022,
             4510.2,4435.9,4250.6,4132.05,4063.65,4028.25,4008.15,
             4076.65,4115.65,4145.85,4096.45,4138.7,4173.95,
             4170.25,4222.66145,4234.918375,4174.941435,4159.94939,
             4176.549635,4191.590285,4244.919585,4295.999005,
             4385.00353,4464.48,4537.50483333333,4595.32683333333),
  NominalWage = c(1575,1599,1638,1702,1757,
                  1766,1856,1915,1928,2012,2222,2325,2450,2629,
                  2831,3018,3174,3413,3687,3877,4098,4364,4651,
                  4862,5452,5961,6435,6987,8968,10571,13446,17934,
                  22294,27173,33309,38900,46837,57270,67764,77187,
                  87645,103553,122482,137193,145520,158343,171351,
                  185017,198964,199837,202525,213094,223060,230714,
                  237695,247924,263171,297017),
  RealIncome = c(100,100,102,106,109,109,
                 112,116,118,123,129,132,135,139,147,152,153,
                 158,163,160,158,160,158,153,149,151,155,154,
                 146,147,142,132,131,125,134,118,112,118,122,
                 125,127,135,153,167,166,176,182,174,175,171,174,
                 178,172,177,183,191,205,226),
  Consumption = c(100,101,104,109,114,115,
                  121,128,134,140,150,157,162,168,177,185,188,
                  195,202,206,208,213,216,217,220,225,230,238,
                  238,251,238,216,216,220,220,205,201,203,211,
                  224,233,245,265,286,292,301,307,307,307,292,286,
                  289,283,286,292,304,319,335),
  GDP1960 = c(100,105,111,117,123,124,
              133,143,150,161,168,179,190,203,215,228,236,
              254,265,273,273,281,289,291,299,298,302,315,
              315,317,306,269,261,259,267,271,271,280,291,
              300,313,326,341,355,372,388,404,405,409,382,384,
              391,385,393,409,425,434,453),
  GDPCAP1960 = c(100,94.544140830268,
                 95.2540378114436,92.3336787564767,90.4939888364105,
                 92.3298207495926,98.0934036371462,104.457209847597,
                 108.644193173412,115.609638554217,119.385381026439,
                 125.613392034402,131.767681877972,141.556821650219,
                 149.605076142132,157.642691415313,162.387712077101,173.969821125212,
                 180.691404695583,185.739726027397,185.114958448753,
                 189.938264299803,194.846153846154,195.48309320788,
                 200.053299492386,198.608712563205,200.533617515985,
                 208.559698608964,208.037194064367,208.714505283381,
                 200.854625550661,175.576230835159,169.354728770236,
                 167.233725859633,171.67148217636,173.803125292411,
                 173.446073396209,179.273236805231,186.490322580645,
                 192.690469496767,201.626127819549,210.81271818096,221.327083333333,
                 231.532020173185,243.662844036697,255.191632280971,
                 266.893108433735,267.605321507761,270.222286485444,
                 252.602797877472,254.293333333333,259.254522588759,
                 255.671931014437,261.491311523153,272.693190661479,
                 284.107090607627,291.003326159264,304.398235294118),
  Saving = c(NA,NA,NA,NA,NA,NA,NA,
             NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
             NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
             -0.413478759161891,0.677284176814826,2.23839424384988,
             2.68164908165468,-0.612603378753562,0.336316609992216,
             1.66307545442148,1.62415561580485,-0.447014972605301,
             0.639835251472699,0.742985726208944,2.09826750361969,
             0.709148995137185,1.43829132614417,1.68121385439347,
             2.85407080416776,3.06225565974802,2.67376896713213,
             6.62553428360149,7.70924623713167,9.05659774195948,
             9.35930802283431,8.88176740387289),
  HouseholdDebt = c(NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    17.38438,15.80764,15.67531,14.90371,16.5418,19.48742,
                    23.0863,29.98847,38.69801,43.34442,48.81979,
                    55.1312,63.57964,76.93284,77.39824,81.41494,74.73286,
                    64.18519,58.28285,55.48408,48.33141,45.94524,42.96477),
  PensionPublic = c(NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,7.654,7.433,7.424,7.932,7.842,7.92,
                    8.329,8.549,9.007,9.464,9.595,9.574,9.738,10.383,
                    10.224,9.552,9.198,NA,NA),
  FamilyBenefits = c(NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,3.122,2.988,2.873,2.941,3.208,2.95,
                     2.999,3.271,3.225,3.248,3.399,3.392,3.189,3.083,
                     2.98,2.951,2.966,NA,NA),
  Marriage = c(8.9,8.3,8.1,8.4,8.7,8.8,
               9.2,9.4,9.3,9.3,9.3,9.1,9.4,9.7,9.5,9.9,9.5,
               9.1,8.7,8.1,7.5,7.2,7.1,7.1,7.1,6.9,6.9,6.3,
               6.3,6.4,6.4,5.9,5.5,5.2,5.2,5.2,4.7,4.6,4.4,
               4.4,4.7,4.3,4.5,4.5,4.3,4.4,4.4,4.1,
               3.99524296616082,3.66469963855366,3.55199183041879,
               3.59135401477367,3.64512926267858,3.73857225375127,3.93048454624289,
               4.68727712651026,5.27867114230321,5.1667527247234),
  UnemploymentM = c(NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,7.584572,7.052299,6.347412,6.15628,
                    6.117216,6.066829,6.985204,7.143178,7.132286,7.660876,
                    10.27447,11.61458,11.0743,11.34615,10.22646,
                    7.568799,6.628603,5.1233,3.811268),
  UnemploymentT = c(NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,6.995957,6.416963,5.72702,5.829966,
                    5.869752,6.079033,7.188301,7.494521,7.406472,7.817173,
                    10.02932,11.17377,11.03269,11.00812,10.18524,
                    7.728486,6.817803,5.119285,4.157162),
  UnemploymentW = c(NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,6.268268,5.63053,4.970018,5.437218,
                    5.575861,6.092313,7.425467,7.911752,7.732337,8.003463,
                    9.738155,10.66368,10.98449,10.61539,10.13842,
                    7.916661,7.041789,5.110628,4.571421),
  P90P10 = c(NA,NA,NA,NA,NA,NA,NA,
             NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
             NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
             NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,3.1,3.1,3,
             2.9,3.3,3.2,3.5,3.4,3.6,3.4,3.3,NA),
  PovertyRate017 = c(NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.106,0.101,
                     0.092,0.096,0.121,0.125,0.126,0.144,0.128,0.106,
                     0.077,NA),
  PovertyRate66 = c(NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.034,0.023,
                    0.024,0.019,0.02,0.024,0.017,0.017,0.025,0.038,
                    0.052,NA),
  PovertyRate1865 = c(NA,NA,NA,NA,NA,NA,NA,
                      NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                      NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                      NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.069,0.063,
                      0.058,0.06,0.073,0.077,0.091,0.082,0.089,0.089,
                      0.081,NA),
  PovertyRateTot = c(NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                     NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.072,0.065,
                     0.059,0.061,0.073,0.077,0.086,0.083,0.086,0.085,
                     0.078,NA),
  Gini = c(NA,NA,NA,NA,NA,NA,NA,
           NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
           NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
           NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,0.264,0.257,
           0.246,0.241,0.266,0.27,0.28,0.277,0.282,0.284,
           0.282,NA),
  MDeprivationT = c(NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                    NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,61.2,69,73.4,
                    63.3,78.9,69.9,73.5,71.2,69.9,69.2,71.8,69.7,
                    72.4),
  MDeprivation018 = c(NA,NA,NA,NA,NA,NA,NA,
                      NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                      NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                      NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,59.6,67.3,72.2,
                      61.3,76.2,64.8,68.8,66.3,65.6,64.3,67.7,64.3,
                      67.2),
  MDeprivation1865 = c(NA,NA,NA,NA,NA,NA,NA,
                       NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                       NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                       NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,62.4,70.3,74.8,
                       64.2,80.1,71.4,74.9,72.8,70.8,70.1,72.6,70.3,
                       73.4),
  HousesTotal = c(58059,67527,54099,52728,
                  53405,54597,55592,62633,67084,61845,80276,75302,
                  90194,85211,87843,99588,93905,93396,88153,88196,
                  89065,76975,75556,74214,70432,72507,69428,57200,
                  50566,51487,43771,33164,25807,20925,20947,24718,
                  28257,28130,20323,19287,21583,28054,31511,35543,
                  43913,41084,33864,36159,36075,31994,20823,12655,
                  10560,7292.99999999999,8358,7612,9994,14389),
  HousesRate = c(58.2,67.3,53.8,52.3,52.8,
                 53.8,54.6,61.3,65.4,60,77.7,72.7,86.8,81.7,
                 83.9,94.6,88.7,87.8,82.6,82.4,83.2,71.9,70.7,69.6,
                 66.3,68.5,65.9,54.5,48.4,49.5,42.2,32,24.9,
                 20.2,20.3,23.9,27.4,27.3,19.8,18.8,21.1,27.5,31,
                 35.1,43.4,40.7,33.6,36,35.9,31.9,20.8,12.7,10.6,
                 7.4,8.5,7.7,10.2,14.7),
  CaesareanSections = c(NA,NA,NA,NA,NA,NA,NA,
                        NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                        NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,NA,
                        NA,NA,NA,NA,NA,NA,NA,NA,NA,256.9,278.6,280.9,
                        285.6,298.4,313.1,324.8,332,340.1,349.1,356.7,
                        372.1,370.8,373),
  Crime = c(NA,NA,NA,NA,NA,121961,
            121056,119872,118254,110622,122289,123147,125999,
            125388,111825,120889,129424,123623,126907,125267,
            130470,134914,139795,151505,157036,165816,182867,
            188397,185344,225393,341061,440370,447222,400935,
            389451,502036,466050,514403,600621,505716,450673,
            465694,420782,413343,418883,436522,425941,426914,
            408407,394034,447186,451371,472225,377829,329575,
            280113,290779,226452),
  CriminalYoung = c(NA,NA,NA,NA,NA,7415,
                    7743,7400,7021,7638,8314,9453,9390,7963,6974,7520,
                    7072,6852,7019,6787,6535,7394,7829,8817,9691,
                    9449,10574,9887,8667,9661,12264,13509,15476,15001,
                    14479,14321,13544,13955,12866,11540,11081,11631,
                    11689,10473,12325,12197,11287,10909,11438,10036,
                    11248,11034,10056,10211,8740,7815,7647,6458),
  CriminalAdult = c(NA,NA,NA,NA,NA,79900,
                    80009,69409,61426,63872,58363,67521,68650,68054,
                    62543,64529,69505,71704,72497,67051,66345,70255,
                    69345,74507,73802,76317,82602,82756,73662,79271,
                    99990,109326,117168,107620,105015,106800,108682,
                    117011,127217,120118,111699,108850,110097,107557,
                    117662,121593,112884,105252,105146,101678,111280,
                    101860,90182,93404,96396,91133,90458,83894),
  CriminalTotal = c(NA,NA,NA,NA,NA,87315,
                    87752,76809,68447,71510,66677,76974,78040,76017,
                    69517,72049,76577,78556,79516,73838,72880,77649,
                    77174,83324,83493,85766,93176,92643,82329,88932,
                    112254,122835,132644,122621,119494,121121,122226,
                    130966,140083,131658,122780,120481,121786,118030,
                    129987,133790,124171,116161,116584,111714,122528,
                    112894,100238,103615,105584,99018,98136,90369)
)

FertilityRates <- tibble::tribble(
  ~Year, ~ARG, ~AUS, ~AUT, ~BEL, ~BGR, ~BRA, ~CAN, ~CHE, ~CHL, ~CHN, ~COL, ~CRI, ~CYP, ~CZE, ~DEU, ~DNK, ~ESP, ~EST, ~EU28, ~FIN, ~FRA, ~GBR, ~GRC, ~HRV, ~HUN, ~IDN, ~IND, ~IRL, ~ISL, ~ISR, ~ITA, ~JPN, ~KOR, ~LTU, ~LUX, ~LVA, ~MEX, ~MLT, ~NLD, ~NOR, ~NZL, ~OAVG, ~PER, ~POL, ~PRT, ~ROU, ~RUS, ~SAU, ~SVK, ~SVN, ~SWE, ~TUR, ~USA, ~ZAF,
  1960, 3.11, 3.45, 2.69, 2.54, 2.31, 6.07,  3.9, 2.44,  5.1, 5.75, 6.81, 6.45,   NA, 2.11, 2.37, 2.54, 2.86, 1.98,   2.6, 2.71, 2.74, 2.72, 2.23,  2.2, 2.02, 5.67, 5.91, 3.76, 4.26, 3.95, 2.41,    2,    6,  2.4, 2.28, 1.94, 6.77,   NA, 3.12, 2.91, 4.24,   3.2, 6.97, 2.98,  3.1,   NA, 2.54, 7.22, 3.07, 2.18,  2.2,  6.4, 3.65, 6.04,
  1961,  3.1, 3.55, 2.78, 2.63, 2.29, 6.05, 3.84, 2.53, 5.05, 5.92,  6.8, 6.41,   NA, 2.13, 2.44, 2.55, 2.76, 1.98,   2.6, 2.65, 2.82,  2.8, 2.13, 2.19, 1.94, 5.66,  5.9, 3.79, 3.88,  3.8, 2.41, 1.96,  5.8,  2.4, 2.33, 1.94, 6.76,   NA, 3.22, 2.94, 4.31,   3.2, 6.97, 2.83, 3.16,   NA, 2.54, 7.23, 2.96, 2.26, 2.23, 6.33, 3.62, 6.03,
  1962, 3.09, 3.43,  2.8, 2.59, 2.24,    6, 3.76,  2.6,    5, 6.09, 6.78, 6.32,   NA, 2.14, 2.44, 2.54,  2.8, 1.95,   2.6, 2.66,  2.8, 2.88, 2.16, 2.17, 1.79, 5.65,  5.9, 3.92, 3.98, 3.77, 2.46, 1.98,  5.6,  2.4, 2.35, 1.91, 6.76,   NA, 3.18, 2.91, 4.19,   3.1, 6.96, 2.72, 3.21,   NA, 2.42, 7.24, 2.83, 2.27, 2.26, 6.26, 3.46, 6.01,
  1963, 3.08, 3.34, 2.82, 2.68, 2.21, 5.94, 3.67, 2.67, 4.93, 6.24, 6.74,  6.2,   NA, 2.33, 2.51, 2.64, 2.88, 1.89,   2.7, 2.66,  2.9, 2.92, 2.14, 2.12, 1.82, 5.63, 5.88, 4.01, 3.98, 3.81, 2.56,    2,  5.4,  2.4, 2.33, 1.85, 6.75,   NA, 3.19, 2.93, 4.05,   3.1, 6.95,  2.7, 3.11,   NA, 2.31, 7.25, 2.93, 2.28, 2.34, 6.19, 3.32, 5.99,
  1964, 3.07, 3.15, 2.79, 2.72, 2.19, 5.85,  3.5, 2.68, 4.84, 6.35, 6.67, 6.04,   NA, 2.36, 2.53,  2.6, 3.01, 1.94,   2.7, 2.58, 2.91, 2.97, 2.24, 2.12,  1.8, 5.62, 5.86, 4.06, 3.86, 3.93,  2.7, 2.05,  5.2,  2.4, 2.38, 1.79, 6.75,   NA, 3.17, 2.98,  3.8,   3.1, 6.92, 2.57, 3.21,   NA, 2.23, 7.26, 2.91, 2.32, 2.48, 6.01, 3.19, 5.96,
  1965, 3.06, 2.97,  2.7, 2.62, 2.09, 5.73, 3.15, 2.61, 4.75,  6.4, 6.57, 5.85,   NA, 2.18,  2.5, 2.61, 2.94, 1.88,   2.6, 2.46, 2.85, 2.89, 2.25, 2.21, 1.81, 5.61, 5.83, 4.03, 3.71, 3.99, 2.67, 2.14,    5,  2.4, 2.42, 1.74, 6.76,   NA, 3.04, 2.94, 3.54,     3, 6.88, 2.52, 3.14,   NA, 2.14, 7.26,  2.8, 2.45, 2.42, 5.84, 2.91, 5.92,
  1966, 3.05, 2.89, 2.66, 2.52, 2.03,  5.6, 2.81, 2.52, 4.63, 6.38, 6.43, 5.63,   NA, 2.01, 2.51, 2.62, 2.99, 1.87,   2.6,  2.4,  2.8, 2.79, 2.32, 2.21, 1.88,  5.6,  5.8, 3.95, 3.58, 3.89, 2.63, 1.58,  4.8,  2.4, 2.37, 1.76, 6.77,   NA,  2.9,  2.9, 3.41,     3, 6.82, 2.34, 3.12,   NA, 2.13, 7.26, 2.67, 2.48, 2.36, 5.66, 2.72, 5.88,
  1967, 3.05, 2.85, 2.62, 2.41, 2.02, 5.45,  2.6, 2.41,  4.5, 6.29, 6.25, 5.38,   NA,  1.9, 2.45, 2.35, 3.03,  1.9,   2.5, 2.32, 2.67, 2.69, 2.45, 2.07, 2.01, 5.58, 5.75, 3.84, 3.28, 3.64, 2.54, 2.23, 4.66,  2.4, 2.25,  1.8, 6.79,   NA, 2.81, 2.81, 3.35,   2.9, 6.73, 2.33, 3.08,   NA, 2.02, 7.26, 2.49, 2.38, 2.27, 5.49, 2.56, 5.83,
  1968, 3.05, 2.89, 2.58, 2.31, 2.27,  5.3, 2.45,  2.3, 4.35, 6.13, 6.03, 5.12,   NA, 1.83, 2.36, 2.12, 2.96, 2.03,   2.5, 2.15, 2.59,  2.6, 2.42, 1.99, 2.06, 5.56,  5.7, 3.78, 3.07, 3.82, 2.49, 2.13, 4.52,  2.4, 2.13, 1.83, 6.81,   NA, 2.72, 2.75, 3.34,   2.8, 6.63, 2.24,    3,   NA,    2, 7.27,  2.4, 2.28, 2.07, 5.31, 2.46, 5.78,
  1969, 3.06, 2.89, 2.49, 2.28, 2.27, 5.15,  2.4, 2.19, 4.19, 5.92,  5.8, 4.86,   NA, 1.86, 2.21,    2, 2.93, 2.13,   2.4, 1.94, 2.53, 2.51, 2.36, 1.91, 2.04, 5.52, 5.65, 3.85, 2.99, 3.83, 2.51, 2.13, 4.53,  2.4, 2.02, 1.88, 6.83,   NA, 2.75, 2.69, 3.28,   2.8, 6.51,  2.2, 2.95,   NA, 1.98, 7.27, 2.43, 2.17, 1.93, 5.18, 2.46, 5.73,
  1970, 3.07, 2.86, 2.29, 2.25, 2.17, 5.01, 2.33,  2.1, 4.02, 5.65, 5.55, 4.61,   NA, 1.91, 2.03, 1.95,  2.9, 2.17,   2.4, 1.83, 2.48, 2.43,  2.4, 1.83, 1.97, 5.47, 5.59, 3.87, 2.81, 3.97, 2.42, 2.13, 4.53,  2.4, 1.98, 2.02, 6.83,   NA, 2.57,  2.5, 3.17,   2.7, 6.38,  2.2, 2.83,   NA, 1.97, 7.28,  2.4, 2.21, 1.94,    5, 2.48, 5.67,
  1971,  3.1, 2.95,  2.2, 2.21,  2.1, 4.88, 2.19, 2.04, 3.84, 5.32,  5.3, 4.39,   NA, 1.98, 1.97, 2.04, 2.88, 2.19,   2.4,  1.7,  2.5,  2.4, 2.32, 1.95, 1.92, 5.41, 5.52, 3.98, 2.92, 3.94, 2.41, 2.16, 4.54, 2.41, 1.96, 2.04, 6.79,   NA, 2.36, 2.49, 3.18,   2.7, 6.24, 2.25, 2.78,   NA, 2.01, 7.29, 2.43, 2.16, 1.96,    5, 2.27, 5.61,
  1972, 3.15, 2.74, 2.08, 2.09, 2.03, 4.76, 2.02, 1.91, 3.67, 4.96, 5.07, 4.19,   NA, 2.07, 1.74, 2.03, 2.86, 2.13,   2.3, 1.59, 2.42,  2.2, 2.32, 1.97, 1.93, 5.34, 5.44, 3.88, 3.09, 3.71, 2.36, 2.14, 4.12, 2.34, 1.75, 2.03,  6.7,   NA, 2.15, 2.38,    3,   2.6,  6.1, 2.24, 2.69,   NA, 2.05,  7.3, 2.49, 2.14, 1.91,    5, 2.01, 5.54,
  1973,  3.2, 2.49, 1.94, 1.95, 2.15, 4.65, 1.93, 1.81, 3.51, 4.57, 4.86, 4.03,   NA, 2.29, 1.56, 1.92, 2.84, 2.06,   2.2,  1.5, 2.31, 2.04, 2.27, 1.98, 1.95, 5.25, 5.36, 3.74, 2.95, 3.68, 2.34, 2.14, 4.07, 2.22, 1.58, 1.96, 6.56,   NA,  1.9, 2.23, 2.76,   2.5, 5.96, 2.26, 2.65,   NA, 2.02, 7.31, 2.56, 2.18, 1.86, 5.59, 1.88, 5.46,
  1974, 3.26, 2.32, 1.91, 1.83, 2.29, 4.55, 1.82, 1.73, 3.35, 4.18, 4.68,  3.9,   NA, 2.43, 1.53,  1.9, 2.89, 2.07,   2.2, 1.62, 2.11, 1.92, 2.38, 1.95,  2.3, 5.15, 5.28, 3.62, 2.66, 3.71, 2.33, 2.05, 3.77, 2.21, 1.58,    2, 6.37,   NA, 1.77, 2.13, 2.58,   2.5, 5.83, 2.26,  2.6,   NA,    2, 7.31,  2.6,  2.1, 1.87, 5.46, 1.84, 5.37,
  1975, 3.32, 2.15, 1.83, 1.74, 2.23, 4.46,  1.8, 1.61, 3.22, 3.81, 4.52, 3.81,   NA,  2.4, 1.48, 1.92,  2.8, 2.04,   2.2, 1.69, 1.93, 1.81, 2.33, 1.92, 2.38, 5.04, 5.19,  3.4, 2.65, 3.68, 2.21, 1.91, 3.43, 2.18, 1.55, 1.97, 6.13,   NA, 1.66, 1.98, 2.37,   2.4, 5.71, 2.27, 2.58, 2.59, 1.99, 7.31, 2.53, 2.16, 1.77, 5.32, 1.77, 5.29,
  1976, 3.37, 2.06, 1.69, 1.73, 2.24, 4.39, 1.76, 1.55,  3.1, 3.47,  4.4, 3.74,   NA, 2.36, 1.51, 1.75,  2.8, 2.07,   2.1, 1.72, 1.83, 1.74, 2.35,  1.9, 2.26, 4.93, 5.11, 3.31, 2.52,  3.7, 2.11, 1.85,    3, 2.18, 1.48, 1.93, 5.86,   NA, 1.63, 1.86, 2.27,   2.3, 5.58,  2.3, 2.58, 2.54, 1.97, 7.31, 2.52, 2.17, 1.68, 5.19, 1.74,  5.2,
  1977, 3.39, 2.01, 1.63, 1.71, 2.21, 4.31, 1.75, 1.53, 2.99, 3.18, 4.28,  3.7,   NA, 2.32, 1.51, 1.66, 2.67, 2.06,   2.1, 1.69, 1.86, 1.69, 2.27, 1.91, 2.17, 4.81, 5.03, 3.27, 2.31, 3.47, 1.97,  1.8, 2.99, 2.14, 1.49, 1.89, 5.59,   NA, 1.58, 1.75, 2.21,   2.3, 5.45, 2.23, 2.48, 2.57, 1.97,  7.3, 2.47, 2.16, 1.64,  4.9, 1.79, 5.11,
  1978, 3.39, 1.95,  1.6, 1.69, 2.15, 4.24,  1.7, 1.51, 2.91, 2.94, 4.18, 3.66,   NA, 2.32,  1.5, 1.67, 2.55, 2.02,     2, 1.65, 1.82, 1.75, 2.28, 1.92, 2.08, 4.68, 4.96, 3.24, 2.35, 3.28, 1.87, 1.79, 2.64, 2.08, 1.47, 1.87, 5.32,   NA, 1.58, 1.77, 2.07,   2.2, 5.31, 2.21, 2.28, 2.52, 1.94, 7.28, 2.45, 2.19,  1.6, 5.05, 1.76, 5.02,
  1979, 3.37, 1.91,  1.6, 1.69, 2.16, 4.16,  1.7, 1.52, 2.83, 2.75, 4.07, 3.62,   NA, 2.29,  1.5,  1.6, 2.37,    2,     2, 1.64, 1.86, 1.86, 2.26, 1.94, 2.02, 4.56, 4.89, 3.23, 2.49, 3.21, 1.76, 1.77,  2.9, 2.05, 1.47, 1.87, 5.06,   NA, 1.56, 1.75, 2.12,   2.2, 5.17, 2.28, 2.17, 2.49,  1.9, 7.25, 2.44, 2.22, 1.66, 4.84, 1.81, 4.93,
  1980, 3.33, 1.89, 1.65, 1.68, 2.05, 4.07, 1.68, 1.55, 2.78, 2.63, 3.97, 3.59,   NA,  2.1, 1.56, 1.55, 2.22, 2.02,     2, 1.63, 1.95,  1.9, 2.23, 1.92, 1.92, 4.43, 4.83, 3.23, 2.48, 3.14, 1.68, 1.75, 2.82, 1.99,  1.5,  1.9, 4.84, 1.99,  1.6, 1.72, 2.03,   2.2, 5.02, 2.28, 2.18, 2.43, 1.89, 7.21, 2.31, 2.11, 1.68, 4.63, 1.84, 4.84,
  1981, 3.27, 1.94, 1.67, 1.67,    2, 3.97, 1.65, 1.55, 2.74, 2.57, 3.86, 3.55,   NA, 2.02, 1.53, 1.44, 2.04, 2.07,   1.9, 1.65, 1.95, 1.82,  2.1, 1.91, 1.88,  4.3, 4.77, 3.07, 2.33, 3.06,  1.6, 1.74, 2.57, 1.98, 1.55,  1.9, 4.64, 1.87, 1.56,  1.7, 2.01,   2.1, 4.88, 2.24, 2.13, 2.36,  1.9, 7.14, 2.28, 1.96, 1.63, 4.41, 1.81, 4.74,
  1982, 3.21, 1.93, 1.66, 1.61, 2.01, 3.86, 1.64, 1.56, 2.71, 2.56, 3.74, 3.52, 2.48, 2.01, 1.51, 1.43, 1.94, 2.08,   1.9, 1.72, 1.91, 1.78, 2.03,  1.9, 1.78, 4.17,  4.7, 2.96, 2.26, 3.12,  1.6, 1.77, 2.39, 1.97, 1.49, 1.98, 4.46, 2.04,  1.5, 1.71, 1.95,   2.1, 4.73, 2.34, 2.07, 2.17, 1.95, 7.05, 2.27, 1.93, 1.62,  4.2, 1.83, 4.65,
  1983, 3.16, 1.92, 1.56, 1.56, 2.01, 3.74, 1.63, 1.52, 2.69, 2.58, 3.63, 3.48,  2.5, 1.96, 1.43, 1.38,  1.8, 2.16,   1.9, 1.74, 1.78, 1.77, 1.94, 1.88, 1.73, 4.03, 4.64, 2.76, 2.24, 3.21, 1.54,  1.8, 2.06,  2.1, 1.44, 2.13,  4.3, 1.97, 1.47, 1.66, 1.92,     2,  4.6, 2.42, 1.95, 2.06, 2.05, 6.93, 2.27, 1.82, 1.61, 4.11,  1.8, 4.54,
  1984, 3.12, 1.84, 1.52, 1.54, 2.01, 3.62, 1.63, 1.53, 2.68, 2.62, 3.53, 3.45, 2.52, 1.97, 1.39,  1.4, 1.73, 2.17,   1.9,  1.7,  1.8, 1.77, 1.82, 1.87, 1.73, 3.89, 4.56, 2.59, 2.08, 3.13, 1.48, 1.81, 1.74, 2.07, 1.42, 2.15, 4.15, 1.97, 1.49, 1.66, 1.93,     2, 4.47, 2.37,  1.9, 2.26, 2.08,  6.8, 2.25, 1.75, 1.65, 3.93, 1.81, 4.43,
  1985, 3.09, 1.92, 1.47, 1.51, 1.97, 3.49, 1.61, 1.52, 2.67, 2.66, 3.42, 3.41, 2.43, 1.96, 1.37, 1.45, 1.64, 2.12,   1.8, 1.64, 1.81, 1.79, 1.68, 1.81, 1.83, 3.75, 4.48,  2.5, 1.93, 3.12, 1.45, 1.76, 1.66, 2.08, 1.38, 2.09, 4.02, 1.99, 1.51, 1.68, 1.93,     2, 4.36, 2.33, 1.72, 2.31, 2.06, 6.65, 2.25, 1.72, 1.73, 3.76, 1.84, 4.32,
  1986, 3.07, 1.87, 1.45, 1.54, 2.02, 3.36, 1.59, 1.53, 2.65, 2.68, 3.32, 3.37, 2.46, 1.94, 1.41, 1.48, 1.56, 2.17,   1.8,  1.6, 1.83, 1.78,  1.6, 1.76, 1.83, 3.61,  4.4, 2.44, 1.93, 3.09, 1.37, 1.72, 1.58, 2.12, 1.44, 2.21,  3.9, 1.94, 1.55, 1.71, 1.96,   1.9, 4.25, 2.22, 1.66, 2.39, 2.11,  6.5,  2.2, 1.65, 1.79, 3.58, 1.84, 4.19,
  1987, 3.06, 1.85, 1.43, 1.54, 1.96, 3.23, 1.58, 1.52, 2.64, 2.65, 3.23, 3.33, 2.38, 1.91, 1.43,  1.5,  1.5, 2.26,   1.8, 1.59,  1.8, 1.81,  1.5, 1.74, 1.81, 3.47, 4.31, 2.31, 2.07, 3.05, 1.35, 1.69, 1.53, 2.11, 1.39, 2.21, 3.79, 1.97, 1.56, 1.75, 2.03,   1.9, 4.14, 2.15, 1.62, 2.38, 2.19, 6.34, 2.14, 1.64, 1.84,  3.4, 1.87, 4.06,
  1988, 3.04, 1.83, 1.45, 1.57, 1.97, 3.11,  1.6, 1.57, 2.61, 2.59, 3.14, 3.28, 2.49, 1.94, 1.46, 1.56, 1.45, 2.26,   1.8,  1.7, 1.81, 1.82,  1.5, 1.74, 1.79, 3.35, 4.22, 2.17, 2.27, 3.06, 1.38, 1.66, 1.55, 2.02, 1.51, 2.16, 3.68,  2.1, 1.55, 1.84,  2.1,   1.9, 4.04, 2.13, 1.62,  2.3, 2.13, 6.19, 2.15, 1.63, 1.96, 3.29, 1.93, 3.92,
  1989, 3.02, 1.84, 1.45, 1.58,  1.9, 3.01, 1.66, 1.56, 2.58, 2.49, 3.07, 3.23, 2.36, 1.87, 1.42, 1.62,  1.4, 2.22,   1.8, 1.71, 1.79, 1.79,  1.4, 1.67, 1.78, 3.23, 4.13, 2.08,  2.2, 3.03, 1.35, 1.57, 1.56, 1.98, 1.52, 2.05, 3.57, 2.11, 1.55, 1.89, 2.12,   1.9, 3.93, 2.07, 1.58, 2.22, 2.01, 6.05, 2.08, 1.52, 2.02, 3.39, 2.01, 3.79,
  1990, 2.99,  1.9, 1.46, 1.62, 1.82, 2.91, 1.71, 1.59, 2.55, 2.35, 2.99, 3.17, 2.41, 1.89, 1.45, 1.67, 1.36, 2.05,   1.8, 1.79, 1.78, 1.83, 1.39, 1.67, 1.84, 3.12, 4.04, 2.12, 2.31, 3.02, 1.36, 1.54, 1.57, 2.03, 1.62, 2.01, 3.47, 2.05, 1.62, 1.93, 2.18,   1.9, 3.83, 1.99, 1.56, 1.83, 1.89, 5.91, 2.09, 1.46, 2.14, 3.07, 2.08, 3.65,
  1991, 2.95, 1.85, 1.51, 1.65, 1.66, 2.83,  1.7, 1.58,  2.5, 2.19, 2.93, 3.11, 2.32, 1.86, 1.33, 1.68, 1.33,  1.8,   1.7,  1.8, 1.77, 1.82, 1.37, 1.55, 1.86, 3.02, 3.96, 2.09, 2.19, 2.91, 1.33, 1.53, 1.71, 2.01,  1.6, 1.86, 3.37,  2.1, 1.61, 1.92, 2.09,   1.9, 3.72, 1.98, 1.56, 1.59, 1.73, 5.76, 2.05, 1.42, 2.12,    3, 2.06, 3.53,
  1992, 2.91, 1.89, 1.51, 1.64, 1.55, 2.76, 1.69, 1.58, 2.46, 2.02, 2.86, 3.04, 2.48, 1.72, 1.29, 1.76, 1.32, 1.71,   1.7, 1.85, 1.73, 1.79, 1.36, 1.39, 1.77, 2.93, 3.88, 1.99, 2.21, 2.93, 1.32,  1.5, 1.76, 1.97, 1.67, 1.73, 3.27, 2.12, 1.59, 1.89, 2.06,   1.9, 3.62, 1.85, 1.53, 1.51, 1.55, 5.59, 1.99, 1.34, 2.09, 2.93, 2.05, 3.41,
  1993, 2.87, 1.86,  1.5,  1.6, 1.46, 2.69, 1.66, 1.51, 2.41, 1.87, 2.79, 2.97, 2.24, 1.67, 1.28, 1.75, 1.27, 1.49,   1.6, 1.81, 1.66, 1.76, 1.32, 1.43, 1.69, 2.84,  3.8, 1.91, 2.22, 2.92, 1.26, 1.46, 1.65, 1.74, 1.69, 1.51, 3.18, 2.01, 1.57, 1.86, 2.04,   1.8, 3.51, 1.77, 1.51, 1.43, 1.37, 5.41, 1.93, 1.33,    2, 2.87, 2.02, 3.29,
  1994, 2.82, 1.84, 1.47, 1.55, 1.37, 2.64, 1.62, 1.49, 2.36, 1.74, 2.73,  2.9, 2.17, 1.44, 1.24, 1.81,  1.2, 1.42,   1.6, 1.85, 1.66, 1.74, 1.33, 1.43, 1.64, 2.76, 3.72, 1.85, 2.14,  2.9, 1.22,  1.5, 1.66, 1.57, 1.72, 1.39,  3.1, 1.89, 1.57, 1.87, 1.98,   1.7, 3.41, 1.72, 1.44,  1.4, 1.39,  5.2, 1.67, 1.32, 1.89, 2.81,    2,  3.2,
  1995, 2.76, 1.82, 1.42, 1.55, 1.23, 2.59, 1.62, 1.48, 2.31, 1.64, 2.66, 2.82, 2.03, 1.28, 1.25, 1.81, 1.17, 1.38,   1.5, 1.81, 1.71, 1.71, 1.28,  1.5, 1.57, 2.69, 3.65, 1.85, 2.08, 2.88, 1.19, 1.42, 1.63, 1.55, 1.67, 1.26, 3.02, 1.82, 1.53, 1.87, 1.98,   1.7, 3.32, 1.55, 1.41, 1.33, 1.34, 4.98, 1.52, 1.29, 1.74, 2.75, 1.98, 3.11,
  1996, 2.71,  1.8, 1.45, 1.58, 1.23, 2.54, 1.62,  1.5, 2.27, 1.57,  2.6, 2.74, 1.95, 1.19, 1.32, 1.75, 1.16, 1.37,   1.5, 1.76, 1.73, 1.73, 1.26, 1.64, 1.46, 2.63, 3.58, 1.89, 2.12, 2.94, 1.22, 1.43, 1.57, 1.49, 1.76, 1.16, 2.95, 2.01, 1.53, 1.89, 1.96,   1.7, 3.23, 1.53, 1.44,  1.3, 1.27, 4.75, 1.47, 1.28, 1.61, 2.69, 1.98, 3.04,
  1997, 2.66, 1.78, 1.39, 1.59, 1.09, 2.48, 1.58, 1.48, 2.23, 1.53, 2.54, 2.65, 1.86, 1.17, 1.37, 1.76, 1.18, 1.32,   1.5, 1.75, 1.73, 1.72, 1.27, 1.69, 1.38, 2.58, 3.51, 1.94, 2.04, 2.93, 1.23, 1.39, 1.52, 1.47, 1.71, 1.11, 2.88, 1.95, 1.56, 1.86, 1.96,   1.7, 3.14, 1.47, 1.47, 1.32, 1.22, 4.53, 1.43, 1.25, 1.53, 2.63, 1.97, 2.97,
  1998, 2.62, 1.76, 1.37, 1.57, 1.11, 2.43, 1.54, 1.47, 2.18,  1.5, 2.48, 2.56, 1.76, 1.16, 1.36, 1.73, 1.16, 1.28,   1.5, 1.71, 1.76, 1.71, 1.24, 1.45, 1.33, 2.54, 3.45, 1.95, 2.05, 2.98, 1.21, 1.38, 1.45, 1.46, 1.67,  1.1, 2.82, 1.81, 1.63, 1.81, 1.89,   1.6, 3.06, 1.41, 1.48, 1.32, 1.23, 4.33, 1.37, 1.23, 1.51, 2.56,    2, 2.92,
  1999, 2.59, 1.76, 1.34, 1.59, 1.23, 2.37, 1.51, 1.48, 2.14, 1.49, 2.43, 2.46, 1.67, 1.13, 1.36, 1.74, 1.19,  1.3,   1.5, 1.73, 1.79, 1.68, 1.23, 1.38, 1.29, 2.52, 3.38, 1.91, 1.99, 2.94, 1.23, 1.34, 1.41, 1.46, 1.71, 1.18, 2.77, 1.72, 1.65, 1.85, 1.97,   1.6, 2.99, 1.37, 1.51,  1.3, 1.16, 4.14, 1.33, 1.21,  1.5, 2.48, 2.01, 2.87,
  2000, 2.56, 1.76, 1.36, 1.64, 1.26,  2.3, 1.49,  1.5, 2.11,  1.5, 2.39, 2.37, 1.64, 1.14, 1.38, 1.77, 1.23, 1.36,   1.5, 1.73, 1.87, 1.64, 1.25, 1.39, 1.33, 2.51, 3.31,  1.9, 2.08, 2.95, 1.26, 1.36, 1.47, 1.39, 1.78, 1.25, 2.72, 1.69, 1.72, 1.85, 1.98,   1.7, 2.93, 1.37, 1.56, 1.31,  1.2, 3.97, 1.29, 1.26, 1.55, 2.27, 2.06, 2.83,
  2001, 2.54, 1.73, 1.33, 1.64, 1.21, 2.23, 1.51, 1.38, 2.07, 1.51, 2.35, 2.29, 1.57, 1.15, 1.35, 1.75, 1.24, 1.32,   1.4, 1.73, 1.88, 1.63, 1.25, 1.46, 1.31, 2.51, 3.24, 1.96, 1.95, 2.89, 1.25, 1.33,  1.3, 1.29, 1.66, 1.22, 2.67,  1.5, 1.71, 1.78, 1.97,   1.6, 2.87, 1.32, 1.46, 1.27, 1.22, 3.83,  1.2, 1.21, 1.57, 2.37, 2.03, 2.79,
  2002, 2.52, 1.77, 1.39, 1.62, 1.21, 2.16,  1.5, 1.39, 2.05, 1.52, 2.31, 2.22, 1.49, 1.17, 1.34, 1.72, 1.25, 1.36,   1.4, 1.72, 1.86, 1.63, 1.28, 1.42, 1.31, 2.51, 3.18, 1.98, 1.93, 2.89, 1.27, 1.32, 1.17, 1.23, 1.63, 1.26, 2.62, 1.45, 1.73, 1.75, 1.89,   1.6, 2.82, 1.25, 1.47, 1.27, 1.29, 3.71, 1.19, 1.21, 1.65, 2.17, 2.01, 2.76,
  2003,  2.5, 1.77, 1.38, 1.64, 1.23,  2.1, 1.53, 1.39, 2.02, 1.54, 2.27, 2.15, 1.51, 1.18, 1.34, 1.76,  1.3, 1.36,   1.5, 1.76, 1.87,  1.7, 1.29, 1.41, 1.28, 2.51, 3.11, 1.98, 1.99, 2.95, 1.29, 1.29, 1.18, 1.26, 1.62, 1.32, 2.58, 1.48, 1.75,  1.8, 1.93,   1.6, 2.77, 1.22, 1.44,  1.3, 1.32,  3.6,  1.2,  1.2, 1.72, 2.09, 2.04, 2.73,
  2004, 2.47, 1.78, 1.42,  1.7, 1.29, 2.03, 1.53, 1.42,    2, 1.55, 2.24, 2.11, 1.52, 1.23, 1.36, 1.79, 1.31, 1.47,   1.5,  1.8,  1.9, 1.75, 1.31, 1.43, 1.28, 2.52, 3.04, 1.95, 2.03,  2.9, 1.33, 1.29, 1.15, 1.27, 1.66, 1.29, 2.54,  1.4, 1.73, 1.83, 1.98,   1.6, 2.73, 1.23, 1.41, 1.33, 1.33, 3.51, 1.24, 1.25, 1.75, 2.11, 2.05,  2.7,
  2005, 2.45, 1.85, 1.41, 1.74, 1.32, 1.98, 1.54, 1.42, 1.98, 1.57,  2.2, 2.07, 1.48, 1.28, 1.34,  1.8, 1.33, 1.52,   1.5,  1.8, 1.92, 1.76, 1.34,  1.5, 1.32, 2.51, 2.97, 1.88, 2.05, 2.84, 1.32, 1.26, 1.08, 1.29, 1.62, 1.39,  2.5, 1.38, 1.71, 1.84, 1.97,   1.6, 2.68, 1.24, 1.42,  1.4, 1.29, 3.42, 1.25, 1.26, 1.77, 2.12, 2.06, 2.68,
  2006, 2.43, 1.88, 1.41, 1.78, 1.38, 1.93, 1.59, 1.44, 1.96, 1.57, 2.16, 2.03, 1.52, 1.33, 1.33, 1.85, 1.36, 1.58,   1.5, 1.84, 1.98, 1.82,  1.4, 1.47, 1.35, 2.51,  2.9, 1.94, 2.07, 2.88, 1.35, 1.32, 1.12, 1.33, 1.64, 1.46, 2.46, 1.36, 1.72,  1.9, 2.01,   1.7, 2.65, 1.27, 1.38, 1.42, 1.31, 3.33, 1.24, 1.31, 1.85, 2.12, 2.11, 2.66,
  2007, 2.41, 1.99, 1.39,  1.8, 1.49, 1.88, 1.66, 1.46, 1.95, 1.58, 2.12, 2.01, 1.44, 1.44, 1.37, 1.84, 1.38, 1.69,   1.5, 1.83, 1.95, 1.86, 1.41, 1.48, 1.32, 2.51, 2.82, 2.03, 2.09,  2.9, 1.37, 1.34, 1.25, 1.36, 1.61, 1.54, 2.42, 1.35, 1.72,  1.9, 2.18,   1.7, 2.62, 1.31, 1.35, 1.45, 1.42, 3.24, 1.25, 1.38, 1.88, 2.16, 2.12, 2.64,
  2008,  2.4, 2.02, 1.42, 1.86, 1.56, 1.85, 1.68, 1.48, 1.93, 1.58, 2.08, 1.98, 1.48,  1.5, 1.38, 1.89, 1.45, 1.72,   1.6, 1.85, 1.99, 1.91,  1.5, 1.55, 1.35,  2.5, 2.75, 2.07, 2.14, 2.96, 1.42, 1.37, 1.19, 1.45,  1.6, 1.58, 2.39, 1.43, 1.77, 1.96, 2.19,   1.7, 2.59, 1.39,  1.4,  1.6,  1.5, 3.15, 1.32, 1.53, 1.91, 2.15, 2.07, 2.62,
  2009, 2.38, 1.97,  1.4, 1.83, 1.66, 1.82, 1.67,  1.5,  1.9, 1.59, 2.04, 1.95, 1.47, 1.49, 1.36, 1.84, 1.38,  1.7,   1.6, 1.86, 1.99, 1.89,  1.5, 1.58, 1.33, 2.49, 2.67, 2.07, 2.22, 2.96, 1.41, 1.37, 1.15,  1.5, 1.59, 1.46, 2.36, 1.42, 1.79, 1.98, 2.13,   1.7, 2.57,  1.4, 1.35, 1.66, 1.54, 3.06, 1.41, 1.53, 1.94,  2.1,    2,  2.6,
  2010, 2.37, 1.95, 1.44, 1.84, 1.57, 1.81, 1.63, 1.54, 1.88, 1.59, 2.01, 1.92, 1.44, 1.49, 1.39, 1.87, 1.37, 1.72,   1.6, 1.87, 2.02, 1.92, 1.48, 1.55, 1.26, 2.48,  2.6, 2.06,  2.2, 3.03, 1.41, 1.39, 1.23,  1.5, 1.63, 1.36, 2.34, 1.36,  1.8, 1.95, 2.17,   1.7, 2.55, 1.38, 1.39, 1.59, 1.57, 2.96,  1.4, 1.57, 1.98, 2.08, 1.93, 2.59,
  2011, 2.36, 1.92, 1.43, 1.81, 1.51, 1.79, 1.61, 1.52, 1.86, 1.59, 1.98, 1.89, 1.35, 1.43, 1.39, 1.75, 1.34, 1.61,   1.6, 1.83,    2, 1.91,  1.4, 1.48, 1.24, 2.47, 2.53, 2.04, 2.02,    3, 1.39, 1.39, 1.24, 1.55, 1.51, 1.33, 2.32, 1.45, 1.76, 1.88, 2.09,   1.7, 2.53,  1.3, 1.35, 1.47, 1.58, 2.87, 1.45, 1.56,  1.9, 2.05, 1.89, 2.57,
  2012, 2.35, 1.93, 1.44, 1.79,  1.5, 1.78, 1.61, 1.53, 1.83,  1.6, 1.95, 1.87, 1.39, 1.45, 1.41, 1.73, 1.32, 1.56,   1.6,  1.8, 1.99, 1.92, 1.34, 1.51, 1.34, 2.46, 2.48, 2.01, 2.04, 3.05, 1.42, 1.41,  1.3,  1.6, 1.57, 1.44,  2.3, 1.42, 1.72, 1.85,  2.1,   1.7,  2.5,  1.3, 1.28, 1.52, 1.69, 2.78, 1.34, 1.58, 1.91, 2.11, 1.88, 2.55,
  2013, 2.34, 1.88, 1.44, 1.74, 1.48, 1.77, 1.59, 1.52, 1.82,  1.6, 1.92, 1.84,  1.3, 1.46, 1.42, 1.67, 1.27, 1.52,   1.5, 1.75, 1.97, 1.83, 1.29, 1.46, 1.34, 2.44, 2.42, 1.96, 1.93, 3.03, 1.39, 1.43, 1.19, 1.59, 1.55, 1.52, 2.27, 1.36, 1.68, 1.78, 2.01,   1.7, 2.48, 1.26, 1.21, 1.41, 1.71,  2.7, 1.34, 1.55, 1.89, 2.11, 1.86, 2.53,
  2014, 2.32, 1.79, 1.46, 1.73, 1.53, 1.75, 1.58, 1.54,  1.8, 1.61,  1.9, 1.82, 1.31, 1.53, 1.47, 1.69, 1.32, 1.54,   1.5, 1.71, 1.97, 1.81,  1.3, 1.46, 1.41, 2.41, 2.38, 1.95, 1.93, 3.08, 1.37, 1.42, 1.21, 1.63,  1.5, 1.65, 2.24, 1.38, 1.71, 1.76, 1.92,   1.7, 2.46, 1.29, 1.23, 1.52, 1.75, 2.64, 1.37, 1.58, 1.88, 2.18, 1.86, 2.51,
  2015, 2.31, 1.79, 1.49, 1.69, 1.53, 1.74, 1.56, 1.54, 1.79, 1.62, 1.87,  1.8, 1.32, 1.57,  1.5, 1.71, 1.33, 1.58,   1.6, 1.65, 1.93,  1.8, 1.33,  1.4, 1.44, 2.39, 2.35, 1.94, 1.81, 3.09, 1.35, 1.45, 1.24,  1.7, 1.47,  1.7, 2.22, 1.37, 1.66, 1.73, 1.99,   1.7, 2.43, 1.29,  1.3, 1.58, 1.78, 2.58,  1.4, 1.57, 1.85, 2.15, 1.84, 2.49,
  2016, 2.29, 1.79, 1.53, 1.67, 1.54, 1.73, 1.54, 1.54, 1.77, 1.62, 1.85, 1.78, 1.37, 1.63,  1.6, 1.79, 1.34,  1.6,   1.6, 1.57, 1.89, 1.79, 1.38, 1.42, 1.49, 2.36, 2.33, 1.87, 1.75, 3.11, 1.34, 1.44, 1.17, 1.69, 1.41, 1.74, 2.18, 1.37, 1.66, 1.71, 1.87,   1.7,  2.4, 1.36, 1.36, 1.64, 1.76, 2.53, 1.48, 1.58, 1.85, 2.11, 1.82, 2.46,
  2017, 2.28, 1.74, 1.52, 1.64, 1.56, 1.71,  1.5, 1.52, 1.77, 1.63, 1.83, 1.77, 1.32, 1.69, 1.57, 1.75, 1.31, 1.59,   1.6, 1.49, 1.86, 1.74, 1.35, 1.42, 1.49, 2.34,  2.3, 1.88, 1.71, 3.11, 1.32, 1.43, 1.05, 1.63, 1.39, 1.69, 2.15, 1.26, 1.62, 1.62, 1.81,   1.7, 2.37, 1.45, 1.37, 1.71, 1.62, 2.49, 1.52, 1.62, 1.78, 2.07, 1.77, 2.43
) %>% data.frame()

NeighbourCountry <- tibble::tribble(
  ~ARG, ~AUS, ~AUT, ~BEL, ~BGR, ~BRA, ~CAN, ~CHE, ~CHL, ~CHN, ~COL, ~CRI, ~CYP, ~CZE, ~DEU, ~DNK, ~ESP, ~EST, ~FIN, ~FRA, ~GBR, ~GRC, ~HRV, ~HUN, ~IDN, ~IND, ~IRL, ~ISL, ~ISR, ~ITA, ~JPN, ~KOR, ~LTU, ~LUX, ~LVA, ~MEX, ~MLT, ~NLD, ~NOR, ~NZL, ~PER, ~POL, ~PRT, ~ROU, ~RUS, ~SAU, ~SVK, ~SVN, ~SWE, ~TUR, ~USA, ~ZAF,
  NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,
  1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,
  NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,
  NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,    1,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,
  NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,
  NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,
  NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,    1,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,    1,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,
  NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,    1,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,
  NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,    1,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,    1,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,    1,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,    1,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,
  NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA,   NA
) %>% data.frame()

MyTheme <-   theme_economist() + theme(
  legend.title = element_blank(),
  plot.title = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
  axis.title = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
  axis.ticks.length = unit(5, "points"),
  panel.grid.major = element_line(colour = "grey", 
                                  size = rel(1.75))
)

df=data.frame(LiveBirthAndFertility$Year, LiveBirthAndFertility$LiveBirthTotal/LiveBirthAndFertility$LiveBirthTotal[1], LiveBirthAndFertility$LiveBirthTo1000/LiveBirthAndFertility$LiveBirthTo1000[1], LiveBirthAndFertility$TotalFertility/LiveBirthAndFertility$TotalFertility[1])
names(df)=c("Year","Összes született gyermek", "Ezer nőre jutó született gyermekek száma", "Teljes termékenységi arány")
df=df %>% gather(key="variable", value = "value", -Year)

p1 <- ggplot(df, aes(x = Year, y = value)) + 
  geom_line(aes(color = variable), size = 2) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1),expand=c(0,0),limits=c(0.5, 1.5)) +
  scale_x_continuous(expand=c(0,0)) +
  labs(title = "1. ábra. Születési mutatók bázisindexe", subtitle = "1960=100%",
       caption="A bázisindex használatát a három mutató együttesen való ábrázolásának céljából tartottam indokoltnak.") +
  xlab("Év")+
  ylab("Százalék") +
  scale_color_economist() +
  MyTheme + theme(
    legend.text = element_text(size = 10)
  )

df=data.frame(LiveBirthAndFertility$Year, LiveBirthAndFertility$TotalFertility,rep(2.1,length(LiveBirthAndFertility$TotalFertility)))
names(df)=c("Year", "Teljes termékenységi arány","Az egyszerű reprodukciót jelentő érték")
df=df %>% gather(key="variable", value = "value", -Year)

p2 <- ggplot(df, aes(x = Year, y = value)) + 
  geom_line(aes(color = variable,linetype=variable), size = 2) +
  scale_y_continuous(expand=c(0.1,0.1)) +
  scale_x_continuous(expand=c(0,0)) +
  labs(title = "2. ábra. Magyarország termékenységi rátájának alakulása", subtitle="1960-2018",
  caption="Megjegyzés: Az ábra alapján jól látható, hogy az érték a vizsgált időszakban jelentősen a 2,1-es egyszerű reprodukció határát jelentő érték alatt maradt, globális minimumát (1,23) pedig 2011-ben érte el."     
       ) +
  scale_color_manual(values = c("#e3120b","#244747")) +
  scale_linetype_manual(values = c("longdash","solid"))+
  ylab("Gyermek/anya")+
  xlab("Év")+
  MyTheme

t1 <- tibble::tribble(
  ~"Szerző", ~"Szerző által mely országra fogalmazódott meg a hipotézis", ~"Forrás alapján elemzésem fókuszába helyezett indikátorok",
  "*Tárkányi*",                                            "Magyarország",                       "jövedelem és foglalkoztatás mutatói",
  "*Cumming* és *Dettling*",                                      "Egyesült Királyság",                      "megtakarítások és eladósodás mutatói",
  "*Levitt* és *Dubner*",                                        "Egyesült Államok",            "bűnözési statisztikák, császármetszések aránya",
  "*Duflo* és *Banerjee*",                                                   "India",           "nyugdíjkifizetések mértéke, szegénységi mutatók"
) %>% data.frame()
names(t1)=c("Szerző", "Szerző által mely országra fogalmazódott meg a hipotézis", "Forrás alapján elemzésem fókuszába helyezett indikátorok")
t1 <- t1 %>% kable(caption = "1. táblázat. Szakirodalom áttekintése alapján dolgozatom témájának releváns gazdasági- és társadalmi indikátorainak köre", align = c("l",rep("c",2))) %>%
  kable_styling(bootstrap_options = "striped",full_width = T, fixed_thead = T)


df=data.frame(LiveBirthAndFertility$Year,
              hpfilter(LiveBirthAndFertility$TotalFertility, freq = 100)$trend
              ,LiveBirthAndFertility$TotalFertility)

names(df)=c("Year", "HP","TFR")

p3 <- ggplot(df, aes(x = Year)) + 
  geom_line(aes(y=TFR, color = "Magyarország teljes termékenységi arányszáma"),linetype="solid", size = 2) +
  geom_line(aes(y=HP,color = "HP-szűrővel leválaszott trend"),linetype="longdash", size = 2) +
  scale_y_continuous(expand=c(0,0), limits = c(0,2.5)) +
  scale_x_continuous(expand=c(0,0)) +
  labs(title = "3. ábra. Magyarország termékenységi rátájának alakulása és annak trendje", subtitle="1960-2018, Trend leválasztása Hodrick-Prescott szűrő segítségével (alfa=100)") +
  scale_color_manual(values = c("Magyarország teljes termékenységi arányszáma"="#244747","HP-szűrővel leválaszott trend"="#e3120b")) +
  ylab("Gyermek/anya")+
  xlab("Év")+
  MyTheme

df=data.frame(LiveBirthAndFertility$Year[-1],diff(LiveBirthAndFertility$TotalFertility))
names(df)=c("x","y")

p4 <- ggplot(df, aes(x=x, y=y)) +
  geom_hline(yintercept = 0, size=1.3, color="#4a4a4a") +
  geom_line(size = 2, color="#e3120b") +
  scale_y_continuous(expand=c(0,0), limits = c(-0.5, 0.5)) +
  scale_x_continuous(expand=c(0,0)) +
  labs(title = "4. ábra. Magyarország termékenységi rátájának növekménytagjai", subtitle="1961-2018, Differenciázás segítségével az eredeti idősor determinisztikus, illetve sztochasztikus trendje is eltávolítható") +
  ylab("Gyermek/anya")+
  xlab("Év")+
  MyTheme

Myacf <- acf(diff(LiveBirthAndFertility$TotalFertility), plot = FALSE, lag.max = 20)
Myacf <- with(Myacf, data.frame(lag, acf))
Mypacf <- acf(diff(LiveBirthAndFertility$TotalFertility), plot = FALSE, type = "partial", lag.max = 20)
Mypacf <- with(Mypacf, data.frame(lag, acf))
df=data.frame(
  0:20,
  Myacf$acf,
  c(1,Mypacf$acf)
)
names(df)=c("lag","acf","pacf")
df=df %>% gather("variable","value",-"lag")
variable_names_p5 = list("acf" = "Korrelogram (ACF)",
                      "pacf" = "Parciális korrelogram (PACF)")

variable_labeller_p5 <- function(variable, value) {
  return(variable_names_p5[value])
}

p5 <- ggplot(df, aes(x=lag, y=value)) +
  geom_hline(yintercept = 0, color="grey38", size=1) +
  geom_line(size=1.2, color="#244747") +
  geom_point( 
    shape=21, fill="#336666", color="#244747",size=3,stroke=1.5) +
  facet_wrap(~ variable, ncol = 1,labeller = variable_labeller_p5) +
  labs(title="5. ábra. Magyarország termékenységi rátájának növekménytagjainak korrelogramja",
       subtitle="Autokorreláció és parciális autokorreláció függvény értékei egyes késleltetések mellett"
  ) +
  scale_y_continuous(expand = c(0,0), limits = c(-1,1)) +
  scale_x_continuous(expand = c(0,0)) +
  xlab("Késleltetés száma") +
  ylab("") +
  theme_economist(dkpanel = T) + theme(
    legend.title = element_blank(),
    plot.title = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
    axis.title = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
    axis.ticks.length = unit(5, "points"),
    panel.grid.major = element_line(colour = "grey", 
                                    size = rel(1.75)),
    panel.spacing = unit(2, "lines")
  )

# Table 2, but imported back from excel
x=diff(LiveBirthAndFertility$TotalFertility)
x=head(x,-10)
auto.arima(x, ic = "aicc",trace = T, method ="CSS")

t2 <- tibble::tribble(
  ~Modell,     ~AIC,
  "ARMA (2, 2) konstans nélkül", -242.885,
  "ARMA (0, 0) konstans nélkül", -240.849,
  "ARMA (1, 0) konstans nélkül", -245.811,
  "ARMA (0, 1) konstans nélkül", -247.251,
  "ARMA (0, 0) konstanssal", -241.485,
  "ARMA (1, 1) konstans nélkül", -243.801,
  "ARMA (0, 2) konstans nélkül", -244.906,
  "ARMA (1, 2) konstans nélkül", -242.047,
  "ARMA (0, 1) konstanssal", -248.674,
  "ARMA (1, 1) konstanssal", -245.643,
  "ARMA (0, 2) konstanssal", -246.473,
  "ARMA (1, 0) konstanssal", -247.669,
  "ARMA (1, 2) konstanssal",  -244.05
) %>% data.frame() %>% kable( caption = "2. táblázat. A magyar termékenységi arányszám növekménytagjaira illesztett ARMA-modellekhez tartozó információs kritériumok", align = c("l",rep("c",2))) %>%
  kable_styling(bootstrap_options = "striped",full_width = T, fixed_thead = T)

# Table 3
df=matrix(nrow = 12,ncol = 3)
df[1,3]=adf.test(LiveBirthAndFertility$LiveBirthTotal)$p.value
df[2,3]=adf.test(diff(LiveBirthAndFertility$LiveBirthTotal))$p.value
df[3,3]=adf.test(log(LiveBirthAndFertility$LiveBirthTotal))$p.value
df[4,3]=adf.test(diff(log(LiveBirthAndFertility$LiveBirthTotal)))$p.value
df[5,3]=adf.test(LiveBirthAndFertility$LiveBirthTo1000)$p.value
df[6,3]=adf.test(diff(LiveBirthAndFertility$LiveBirthTo1000))$p.value
df[7,3]=adf.test(log(LiveBirthAndFertility$LiveBirthTo1000))$p.value
df[8,3]=adf.test(diff(log(LiveBirthAndFertility$LiveBirthTo1000)))$p.value
df[9,3]=adf.test(LiveBirthAndFertility$TotalFertility)$p.value
df[10,3]=adf.test(diff(LiveBirthAndFertility$TotalFertility))$p.value
df[11,3]=adf.test(log(LiveBirthAndFertility$TotalFertility))$p.value
df[12,3]=adf.test(diff(log(LiveBirthAndFertility$TotalFertility)))$p.value
df=data.frame(df)
df[,3]=percent(df[,3],d=2)
df[,1]=c(rep("Összes születés",4),rep("Ezer főre eső születés",4),rep("TTA",4))
df[,2]=rep(c("x","diff(x)","log(x)","diff(log(x))"),3)
names(df)=c("Születési mutató","Transzformáció","ADF-teszthez tartozó p-érték")
t3 <- kable(df,caption = "3. táblázat. Megfontolásra kerülő modellek", align = c("l",rep("c",3))) %>%
  kable_styling(bootstrap_options = "striped",full_width = T, fixed_thead = T)


x1 = 1:12 #collector vectors
x2 = 1:12
x3 = 1:12
x4 = 1:12
x = ts(LiveBirthAndFertility$LiveBirthTotal)
MyArima = auto.arima(head(x,-10), ic = "aic", trace = F)
x1[1] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[1] = sum(abs(tail(x, 10) - forecast(MyArima, 10)$mean) /
              tail(x, 10) * 100) / 10
x3[1] = checkresiduals(MyArima, plot = F)$p.value
x4[1] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(head(x,-10),
                     ic = "aic",
                     trace = F,
                     method = "CSS")
x1[2] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[2] = sum(abs(tail(x, 10) - forecast(MyArima, 10)$mean) /
              tail(x, 10) * 100) / 10
x3[2] = checkresiduals(MyArima, plot = F)$p.value
x4[2] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(diff(log(head(x,-10))), ic = "aic", trace = F)
x1[3] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[3] = sum(abs((tail(exp(
  cumsum(c(
    log(x[1]), MyArima$fitted, forecast(MyArima, 10)$mean
  ))
), 10) - tail(x, 10))) / tail(x, 10) * 100) / 10
x3[3] = checkresiduals(MyArima, plot = F)$p.value
x4[3] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(diff(log(x)),
                     ic = "aic",
                     trace = F,
                     method = "CSS")
x1[4] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[4] = sum(abs((tail(exp(
  cumsum(c(
    log(x[1]), MyArima$fitted, forecast(MyArima, 10)$mean
  ))
), 10) - tail(x, 10))) / tail(x, 10) * 100) / 10
x3[4] = checkresiduals(MyArima, plot = F)$p.value
x4[4] = jarque.bera.test(na.omit(MyArima$residuals))$p.value


x = ts(LiveBirthAndFertility$LiveBirthTo1000)
MyArima = auto.arima(head(x,-10), ic = "aic", trace = F)
x1[5] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[5] = sum(abs(tail(x, 10) - forecast(MyArima, 10)$mean) /
              tail(x, 10) * 100) / 10
x3[5] = checkresiduals(MyArima, plot = F)$p.value
x4[5] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(head(x,-10),
                     ic = "aic",
                     trace = F,
                     method = "CSS")
x1[6] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[6] = sum(abs(tail(x, 10) - forecast(MyArima, 10)$mean) /
              tail(x, 10) * 100) / 10
x3[6] = checkresiduals(MyArima, plot = F)$p.value
x4[6] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(diff(log(head(x,-10))), ic = "aic", trace = F)
x1[7] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[7] = sum(abs((tail(exp(
  cumsum(c(
    log(x[1]), MyArima$fitted, forecast(MyArima, 10)$mean
  ))
), 10) - tail(x, 10))) / tail(x, 10) * 100) / 10
x3[7] = checkresiduals(MyArima, plot = F)$p.value
x4[7] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(diff(log(x)),
                     ic = "aic",
                     trace = F,
                     method = "CSS")
x1[8] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[8] = sum(abs((tail(exp(
  cumsum(c(
    log(x[1]), MyArima$fitted, forecast(MyArima, 10)$mean
  ))
), 10) - tail(x, 10))) / tail(x, 10) * 100) / 10
x3[8] = checkresiduals(MyArima, plot = F)$p.value
x4[8] = jarque.bera.test(na.omit(MyArima$residuals))$p.value



x = ts(LiveBirthAndFertility$TotalFertility)
MyArima = auto.arima(head(x,-10), ic = "aic", trace = F)
x1[9] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                "")
x2[9] = sum(abs(tail(x, 10) - forecast(MyArima, 10)$mean) /
              tail(x, 10) * 100) / 10
x3[9] = checkresiduals(MyArima, plot = F)$p.value
x4[9] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(head(x,-10),
                     ic = "aic",
                     trace = F,
                     method = "CSS")
x1[10] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                 "")
x2[10] = sum(abs(tail(x, 10) - forecast(MyArima, 10)$mean) /
               tail(x, 10) * 100) / 10
x3[10] = checkresiduals(MyArima, plot = F)$p.value
x4[10] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(diff(log(head(x,-10))), ic = "aic", trace = F)
x1[11] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                 "")
x2[11] = sum(abs((tail(exp(
  cumsum(c(
    log(x[1]), MyArima$fitted, forecast(MyArima, 10)$mean
  ))
), 10) - tail(x, 10))) / tail(x, 10) * 100) / 10
x3[11] = checkresiduals(MyArima, plot = F)$p.value


x4[11] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

MyArima = auto.arima(diff(log(x)),
                     ic = "aic",
                     trace = F,
                     method = "CSS")
x1[12] = paste("ARMA (", paste(MyArima$arma[1:2], collapse = ", "), ")", sep =
                 "")
x2[12] = sum(abs((tail(exp(
  cumsum(c(
    log(x[1]), MyArima$fitted, forecast(MyArima, 10)$mean
  ))
), 10) - tail(x, 10))) / tail(x, 10) * 100) / 10
x3[12] = checkresiduals(MyArima, plot = F)$p.value

x4[12] = jarque.bera.test(na.omit(MyArima$residuals))$p.value

df = matrix(ncol = 7, nrow = 12)
df = data.frame(
  c(
    rep("Összes születés", 4),
    rep("Ezer főre eső születés", 4),
    rep("TTA", 4)
  ),
  rep(c(
    "diff(x)", "diff(x)", "log(diff(x))", "log(diff(x))"
  ), 3),
  
  x1,
  rep(c("ML", "CSS"), 6),
  percent(x2 / 100, d = 2),
  percent(x3, d = 2),
  percent(x4, d = 2)
)
names(df) = c(
  "Születési mutató",
  "Transzformáció",
  "Illesztett modell",
  "Becslés módszere",
  "MAPE",
  "Ljung-Box (p-érték)",
  "Jarque-Bera (p-érték)"
)
rownames(df) = NULL



t4 <- kable(df,caption = "4. táblázat. ARMA-modellekkel készített ex-post előrejelzések eredményei",align = c("l",rep("c",6))) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),full_width = T, fixed_thead = F)



x=auto.arima(head(ts(LiveBirthAndFertility$TotalFertility),-10),
             ic = "aic",
             trace = F)
#checkresiduals(x)

df=data.frame(x=x$residuals)

p6 <- ggplot(data = df) +
  stat_function(fun = dnorm, args = list(mean = mean(df$x), sd = sd(df$x)),aes(color="Azonos várható értékő és szórású normáleloszlás gyakorisággörbéje"),geom = "area",fill="#244747", size=0,alpha=0.5)+
  geom_density(aes(x, color="Reziduumok gyakorisági görbéje"),fill="#e3120b",alpha=0.5,linetype="solid" ,position = "stack",size=1.2) + 
  scale_color_manual(values = c("Reziduumok gyakorisági görbéje" = "#e3120b","Azonos várható értékő és szórású normáleloszlás gyakorisággörbéje" = "#244747")) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0), limits = c(0,10)) +
  labs(title="6. ábra. Reziduumok eloszlásának vizsgálata gyakorisági görbén",
       subtitle = "A TTA-ra illesztett ARIMA(0,1,1) modell reziduumai a normál eloszlásnál csúcsosabb eloszlással rendelkeznek (Leptokurtikus)"
  ) +
  xlab("") +
  ylab("") +
  MyTheme +
  theme(
    panel.grid.major = element_line(colour = "white", 
                                    size = rel(1)),
    panel.grid.major.x  = element_line(colour = "white", 
                                       size = rel(1)),
    legend.title = element_blank(),
    legend.position = "none",
  )

x = ts(LiveBirthAndFertility$TotalFertility,
       frequency = 1,
       start = 1960)
h=10
MyArima=auto.arima(x,ic = "aic",trace = F,method = "CSS")
Myforecast=forecast(MyArima,level = c(95), h = h)
MyFrame=matrix(ncol = 5,nrow = length(x)+h)
MyFrame[,1]=c(1960:(1960+length(x)+h-1))
MyFrame[1:length(x),2]=x
MyFrame[1:length(x),3]=Myforecast$fitted
MyFrame[((length(x)+1):(length(x)+h)),3]=Myforecast$mean
MyFrame[((length(x)+1):(length(x)+h)),4]=Myforecast$lower
MyFrame[((length(x)+1):(length(x)+h)),5]=Myforecast$upper
x=c(1960:(1960+length(Myforecast$x)+h-1))
y1=c(1960:(1960+length(Myforecast$x)+h-1))
for (i in 1:(length(Myforecast$x)+h)) {
  y1[i]=as.numeric( MyFrame[i,2])
}
y2=c(Myforecast$fitted,Myforecast$mean)
y3=c(1960:(1960+length(Myforecast$x)+h-1))
for (i in 1:(length(Myforecast$x)+h)) {
  y3[i]=as.numeric( MyFrame[i,4])
}

y4=c(1960:(1960+length(Myforecast$x)+h-1))
for (i in 1:(length(Myforecast$x)+h)) {
  y4[i]=as.numeric( MyFrame[i,5])
}
df=tbl_df(data.frame(x,y1,y2,y3,y4))

df1=df[1:3]
df2=data.frame(y3=c(rep(NA,lengths(df)[1]),df$y3),y4=c(rep(NA,lengths(df)[1]),df$y4))
df1=df1 %>% gather("variable","value",-"x")
df1["variable"]=ifelse(df1$variable=="y1","Eredeti idősor","Pontbecslés")
df2["x"]=df1["x"]
df2=na.exclude(df2)

p7<- ggplot(df) +
  geom_ribbon(data=df2,aes(x=x,ymin=y3,ymax=y4,fill="95%-os konfidencia intervallum"), alpha = 0.3) +
  geom_line(data=df1,
            aes(x=x,y=value,color=variable),size=2) +
  scale_x_continuous(expand=c(0,0)) +
  coord_cartesian(ylim=c(0,2.5)) +
  scale_color_manual(values=c("#e3120b","#336666")) +
  scale_fill_manual(name = "", values = c("95%-os konfidencia intervallum" = "#336666")) +
  ylab("Gyermek/anya")+
  xlab("Év")+
  labs(title = "7. ábra. Előrejelzés a teljes termékenységi arányszámra", subtitle = "ARIMA (0,1,1) modell, a következő 10 évre") +
  MyTheme

df=data.frame(c(ifelse(is.na(t(head(FertilityRates,1))),paste(names(FertilityRates),"*",sep=""),names(FertilityRates)),
                ifelse(is.na(t(head(FertilityRates,1))),paste(names(FertilityRates),"*",sep=""),names(FertilityRates))),
              c(rep("1960",length(FertilityRates)),rep("2017",length(FertilityRates))),
              c(t(head(FertilityRates,1)),t(tail(FertilityRates,1))))
names(df)=c("Country","Year","Value")
df=subset(df,Country!="Year")
ggplot(df, aes(x=Country, y=Value,fill=Year)) + 
  geom_bar(stat="identity",position="dodge",color="black")+
  ylab("Gyermek/nő")+
  xlab("Ország")+
  scale_y_continuous(expand=c(0,0)) + 
  coord_cartesian(ylim = c(0, 7.5))+
  #scale_fill_manual(values=c("#336666", "#e3120b"))+
  scale_color_economist() +
  expand_limits(y=0) + 
  labs(title = "A teljes termékenységi arányszám alakulása globálisan",
       subtitle ="Az OECD országok és az OECD partnerországainak adatai, 1960-ban és 2017-ben",
       caption = "A *-gal jelölt országok esetében nem áll rendelkezésre 1960-as adat."
  ) +
  MyTheme + theme(
    axis.text.x = element_text(angle = 90, vjust = 0.45,size = 11),
  )

df=data.frame(c(ifelse(is.na(t(head(FertilityRates,1))),paste(names(FertilityRates),"*",sep=""),names(FertilityRates)),
                ifelse(is.na(t(head(FertilityRates,1))),paste(names(FertilityRates),"*",sep=""),names(FertilityRates))),
              c(rep("1960",length(FertilityRates)),rep("2017",length(FertilityRates))),
              c(t(head(FertilityRates,1)),t(tail(FertilityRates,1))))
names(df)=c("Country","Year","Value")
df=subset(df,Country!="Year")

# 8th plot
p8 <- ggplot(df, aes(x=Country, y=Value,fill=Year)) + 
  geom_bar(stat="identity",position="dodge",color="black")+
  ylab("Gyermek/nő")+
  xlab("Ország")+
  scale_y_continuous(expand=c(0,0)) + 
  coord_cartesian(ylim = c(0, 7.5))+
  #scale_fill_manual(values=c("#336666", "#e3120b"))+
  scale_color_economist() +
  expand_limits(y=0) + 
  labs(title = "8. ábra. A teljes termékenységi arányszám alakulása globálisan",
       subtitle ="Az OECD országok és az OECD partnerországainak adatai, 1960-ban és 2017-ben",
       caption = "A *-gal jelölt országok esetében nem áll rendelkezésre 1960-as adat."
  ) +
  MyTheme + theme(
    axis.text.x = element_text(angle = 90, vjust = 0.45,size = 11),
  )

# Correlation neighbour countries
df = FertilityRates[-1]
df = df[, !names(df) %in% c("OAVG", "EU28")]
Tcor=0
Ncor=0
NNcor=0
Tn=0
Nn=0
NNn=0
for (i in 1:length(df)) {
  for (j in 1:length(df)) {
    if (i>j) {
      x = df[i]
      y = df[j]
      xy=data.frame(x=x,y=y)
      names(xy)=c("x","y")
      xy=na.exclude(xy)
      Mycor=cor(xy$x,xy$y)
      Tcor=Tcor+Mycor
      Tn=Tn+1
      if (!is.na(NeighbourCountry[i,j])) {
        Ncor=Ncor+Mycor
        Nn=Nn+1
      } else {
        NNcor=NNcor+Mycor
        NNn=NNn+1
      }
    }
  }
}
cat(paste(
  "Összes ország között a korrelációk átlaga: ",
  percent(Tcor / Tn, digits = 0 , format = "d"),
  "\n",
  sep = ""
))
cat(paste(
  "Szomszédos országok között a korrelációk átlaga: ",
  percent(Ncor / Nn, digits = 0, format = "d"),
  "\n",
  sep = ""
))
cat(paste(
  "Nem szomszédos országok között a korrelációk átlaga: ",
  percent(NNcor / NNn, digits = 0, format = "d"),
  sep = ""
))

df=FertilityRates[-1]
NdiffFertilityRates=vector()
Years=vector()

Delta=vector()
for (i in 1:length(df)) {
  x=df[i]
  names(x)="x"
  x=x$x
  x=na.exclude(x)
  Delta[i]=tail(x,1)-head(x,1)
  x=ts(x)
  NdiffFertilityRates[i]=ndiffs(
    x,
    alpha = 0.05,
    test = "adf",
    max.d = 10,
    selectlags = "AIC",
    type = "trend"
  )
  y=data.frame(y=FertilityRates$Year,x=df[i])
  y=na.exclude(y)
  Years[i]=paste(min(y$y),"-",max(y$y),sep = "")
}

V=sapply(df, sd,na.rm=T)/sapply(df, mean,na.rm=T)

df=data.frame(Years,Delta,percent(V,d=0),NdiffFertilityRates)
names(df)=c("Megfigyelt évek","Abszolút változás","Varibilitás","Idősor integráltságának rendje")
kable(df,caption="Teljes termékenységi arányszám nemzetközi összehasonlításban", align=c(rep("c",4))) %>%
  column_spec(1, width = "1em", border_right = T) %>%
  column_spec(5, width = "2em") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),full_width = F, fixed_thead = T)
# Cointegrity
df=FertilityRates[-1]
CointOutput = matrix(nrow = length(df),
                     ncol = length(df),
                     dimnames = list(names(df), names(df)))
for (i in 1:length(df)) {
  for (j in 1:length(df)) {
    CointOutput[i,j]=0
    if (i!=j) {
      
      if (NdiffFertilityRates[i]==NdiffFertilityRates[j] & NdiffFertilityRates[i]>0) {
        Mylm=data.frame(y=df[i], x=df[j])
        Mylm=na.exclude(Mylm)
        names(Mylm)=c("y","x")
        Mylm=lm(y~x,data=Mylm)
        x=Mylm$residuals
        x=ts(x)
        x=ndiffs(
          x,
          alpha = 0.05,
          test = "adf",
          max.d = 10,
          selectlags = "AIC",
          type = "trend"
        )
        if ((NdiffFertilityRates[i]-1)==x) {
          CointOutput[i,j]=2
        } else  {
          CointOutput[i,j]=1
        }
      } 
    }
  }
}
CointOutput=data.frame(CointOutput)

df=data.frame(v=rownames(CointOutput),CointOutput)

df = df %>% gather(key = "variable", value = "Coint",-v)
names(df) = c("x", "y", "Coint")

df[,3]=ifelse(df[,3]==0,"A teszt nem elvégezhető",ifelse(df[,3]==1,"Nem kointegráltak","Kointegráltak"))


p10 <- ggplot(df, aes(x, y, fill = factor(Coint))) +
  geom_tile(color="black") +
  labs(title = "10. ábra. Kointegrációs tesztek eredményei") +
  scale_fill_manual(values=c("#acc8d4", "#244747", "#8abbd0")) +
  xlab("OLS során függő változó")+
  ylab("OLS során regresszor")+
  MyTheme +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.45,colour = "black", size = 11),
    axis.ticks.y  = element_line(colour = "black", size=0.6),
    axis.ticks.length.y = unit(.2, "cm"),
    axis.ticks.x  = element_line(colour = "black", size=0.6),
    axis.ticks.length.x = unit(.2, "cm"),
    axis.line.x = element_blank()
  )

df=CointOutput
df=df[-c(19,42),-c(19,42)]
df[,]=df[,]+1
cat(paste("Összes párosítás (OAVG és EU28 nélkül): ",sum(df==3)+sum(df==2)+sum(df==1)-length(df),"\n",sep = ""))
cat(paste("Összes elvégezhető teszt (OAVG és EU28 nélkül): ",sum(df==3)+sum(df==2),"\n",sep = ""))
cat(paste("Összes kointegrálás (OAVG és EU28 nélkül): ",sum(df==3),"\n",sep = ""))

df=(df*NeighbourCountry)
df[is.na(df)] <- 0
cat(paste("Összes szomszédos párosítás: ",sum(df==3)+sum(df==2)+sum(df==1),"\n",sep = ""))
cat(paste("Összes szomszédos elvégezhető teszt: ",sum(df==3)+sum(df==2),"\n",sep = ""))
cat(paste("Összes szomszédos kointegrálás: ",sum(df==3),sep = ""))

df=subset(CointOutput,select="HUN")
df=data.frame(names(CointOutput),df)
df=subset(df,HUN=="2")
cat(paste("Magyarországgal kointegráló országok (OLS során Magyarország a regresszor): ",paste((df[,1]),collapse = ", "), "\n"))

df=subset(t(CointOutput),select="HUN",HUN="2")
df=data.frame(names(CointOutput),df)
df=subset(df,HUN=="2")
cat(paste("Magyarországgal kointegráló országok (OLS során Magyarország a függő változó): ",paste((df[,1]),collapse = ", ")))

HUN <- ts(FertilityRates["HUN"], start = 1960)
CZE <- ts(FertilityRates["CZE"], start = 1960)
HUN_d1 = diff(HUN)
CZE_d1 <- diff(CZE)
MyLm <- lm(HUN ~ CZE)
MyRes <- MyLm$residuals
MyFitted = MyLm$fitted.values
df = matrix(nrow = length(HUN), ncol = 7)
df[, 1] = 1960:2017
df[, 2] = HUN
df[, 3] = CZE
df[, 4] = MyFitted
df[-1, 5] = HUN_d1
df[-1, 6] = CZE_d1
df[, 7] = MyRes
df = data.frame(df)
names(df) = c("Year", "HUN", "CZE", "MyFitted", "HUN_d1", "CZE_d1", "MyRes")
df = df %>% gather(key = "variable", value = "value", -Year)

y = data.frame(unique(df["variable"]), c(1, 1, 1, 2, 2, 3))
df = data.frame(df, MyFacet = plyr::join(df["variable"], y)[, 2])

y = data.frame(unique(df["variable"]),
               c("HUN", "CZE", "OLS becslése (HUN)", "HUN", "CZE", "HUN"))
df = data.frame(df, MyCol = plyr::join(df["variable"], y)[, 2])


variable_names_p9 = list("1" = "Transzformálatlan idősorok",
                      "2" = "Differenciázott idősorok (d=1)",
                      "3" = "OLS maradéktagja")

variable_labeller_p9 <- function(variable, value) {
  return(variable_names_p9[value])
}


p9 <- ggplot(df, aes(Year, value, color = MyCol)) +
  geom_line(size = 2) +
  scale_x_continuous(expand = c(0, 0)) +
  facet_wrap(~ MyFacet,
             scales = "free_y",
             ncol = 1,
             labeller = variable_labeller_p9) +
  labs(title = "9. ábra. A magyar és cseh TTA idősorok között fennálló kointegráció") +
  xlab("Év") +
  ylab("Gyermek/anya") +
  scale_colour_economist() +
  theme_economist(dkpanel = T) + theme(
    legend.title = element_blank(),
    plot.title = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
    axis.title = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
    axis.ticks.length = unit(5, "points"),
    panel.grid.major = element_line(colour = "grey", 
                                    size = rel(1.75))
  )

df=Input[-1]
NdiffInput=vector()
for (i in 1:length(df)) {
  x=df[i]
  x=na.exclude(x)
  x=ts(x)
  NdiffInput[i]=ndiffs(x,test="adf",max.d = 5)
}
for (i in 1:length(df)) {
  if (NdiffInput[i]>1) {
    x=df[i]
    x=na.exclude(x)
    if (sum(x<0)==0) {
      x=diff(log(x))
      x=ts(x)  
      if (ndiffs(x,test="adf",max.d = 5)==0) {
        NdiffInput[i]="ld"
      }
    }
  }
}
df = data.frame(NdiffInput)
names(df) = "Alkalmazott differenciák száma"
rownames(df) = names(Input)[-1]
kable(df, caption = "Alkalmazott differenciák száma a magyar gazdasági-társadalmi változókon a satcionaritás biztosításának érdekében", align = "c") %>%
  column_spec(2, width = "2em", border_left = T) %>%
  column_spec(1, width = "3em") %>%
  kable_styling(
    bootstrap_options = c("striped", "condensed"),
    full_width = F,
    fixed_thead = T,
  ) %>%
  footnote(general = "ld-vel jelöltem azokat az esetek, \namelyekben a változó logaritmusának \nvettem elsőrendű differenciáját.")

df = Input[-1]
d_input = matrix(nrow = lengths(df)[1], ncol = length(df))
for (i in 1:length(df)) {
  d = NdiffInput[i]
  x = data.frame(c(1:lengths(df)[1]), df[i])
  x = na.exclude(x)
  t = x[, 1]
  x = x[, 2]
  if (d == "ld") {
    x = diff(log(x))
    t = t[-1]
    d_input[t, i] = x
  } else  {
    d = as.numeric(d)
    if (d > 0) {
      t = t[-c(1:d)]
      x = diff(x, diff = d)
      d_input[t, i] = x
    } else{
      d_input[t, i] = x
    }
  }
}
d_input = data.frame(d_input)
names(d_input) = names(df)
rownames(d_input) = 1960:2017

d_livebirthandfertility=data.frame(
  LiveBirthTotal=c(NA,diff(LiveBirthAndFertility$LiveBirthTotal)),
  LiveBirthTo1000=c(NA,diff(LiveBirthAndFertility$LiveBirthTo1000)),
  TotalFertility=c(NA,diff(LiveBirthAndFertility$TotalFertility))
)
d_livebirthandfertility=head(d_livebirthandfertility,-1)

y = c(NA, diff(head(
  LiveBirthAndFertility$TotalFertility, -1
)))
Lags = vector()
x_AIC = vector()
y_AIC = vector()
x_cause = vector()
inst_cause = vector()
y_cause = vector()
x = data.frame(d_input$Marriage, y)
names(x) = c("x", "y")
x = na.exclude(x)
x = ts(x)
p = 0
Stop = 0
while (Stop == 0) {
  p = p + 1
  if (p > 1) {
    remove(MyVar)
    remove(MyVarSum)
  }
  try({
    MyVar <- vars::VAR((x), p = p, type = "const")
    MyVarSum <- summary(MyVar)
  }
  , silent = T)
  if (exists("MyVarSum") == F) {
    Stop = 1
  } else {
    Lags[p] = p
    x_AIC[p] = sum(MyVar$varresult$x$residuals * MyVar$varresult$x$residuals) *
      exp(2 * (MyVar$varresult$x$rank + 1) / MyVar$obs)
    y_AIC[p] = sum(MyVar$varresult$y$residuals * MyVar$varresult$y$residuals) *
      exp(2 * (MyVar$varresult$y$rank + 1) / MyVar$obs)
    Mytest = causality(MyVar, cause = "x")
    x_cause[p] = Mytest$Granger$p.value[1]
    inst_cause[p] = Mytest$Instant$p.value[1]
    Mytest = causality(MyVar, cause = "y")
    y_cause[p] = Mytest$Granger$p.value[1]
  }
}
df = data.frame(Lags, x_AIC, y_AIC, x_cause * 100, inst_cause * 100, y_cause *
                  100)
names(df) = c("Lags", 3, 1, 2, 5, 4)
df = df %>% gather(key = "variable", value = "value",-Lags)
variable_names_p11 = list(
  "1" = "Modell alapján becsült TTA reziduumaiból számított AIC",
  "2" = "Házasság kötések száma Granger-oka-e a TTA-nak : F-próba p-értéke (százalék)",
  "3" = "Modell alapján becsült házasság kötések számának reziduumaiból számított AIC",
  "4" = "TTA Granger-oka-e a házasságkötések alakulásának : F-próba p-értéke (százalék)",
  "5" = "Fennáll-e egy idejű Granger-okság : próba p-értéke (százalék)"
)
variable_labeller_p11 <- function(variable, value) {
  return(variable_names_p11[value])
}

df2=df
df2[3]=ifelse(df2[2]!=3 & df2[2]!=1, -Inf, NA)
df2["value2"]=ifelse(df2[2]!=3 & df2[2]!=1,5,NA)
names(df2)=c("Lags","variable","value","value2")

p11 <- ggplot(data = df, aes(Lags, value)) +
  geom_ribbon(data=df2,aes(x=Lags,ymin=value, ymax=value2, fill="5%-os szignifikanciaszint"), alpha=0.5) +
  scale_fill_manual(values = c("5%-os szignifikanciaszint" = "#f8766d")) +
  geom_line(size = 1.2, color="#244747") +
  geom_point( 
    shape=21, fill="#336666", color="#244747",size=3,stroke=1.5) +
  scale_x_continuous(expand = c(0, 0)) +
  ylab("") +
  labs(title = "11. ábra. Granger-oksági tesztek módszertani bemutatása",
       subtitle= "A teljes termékenységi arányszám és a házasságkötések számából kapott VAR-modellek eredményei",
       caption="A vízszintes tengelyen mindegyik esetben az alkalmazott késleltetések száma szerepel,\nmíg a függőleges tengely az összes esetben a vizsgált mutató szerint értelmezendő") +
  xlab("Felhasznált késleltetések száma") +
  facet_wrap( ~ variable,
              ncol = 1,
              scales = "free_y",
              labeller = variable_labeller_p11) +
  theme_economist(dkpanel = T) + theme(
    plot.title = element_text(margin = margin(t = 10, r = 10, b = 10, l = 0)),
    axis.title = element_text(margin = margin(t = 10, r = 10, b = 10, l = 0)),
    axis.ticks.length = unit(5, "points"),
    panel.grid.major = element_line(colour = "grey", 
                                    size = rel(1.75)),
    legend.title = element_blank()
  )

y = c(NA, diff(head(
  LiveBirthAndFertility$TotalFertility, -1
)))
GrangerOutput = matrix(nrow = length(d_input), ncol = 4)
for (i in 1:length(d_input)) {
  x = data.frame(d_input[i], y)
  names(x) = c("x", "y")
  x = na.exclude(x)
  x = ts(x)
  p = 0
  Stop = 0
  while (Stop == 0) {
    p = p + 1
    if (p > 1) {
      remove(MyVar)
      remove(MyVarSum)
    }
    try({
      MyVar <- vars::VAR((x), p = p, type = "const")
      MyVarSum <- summary(MyVar)
    }
    , silent = T)
    if (exists("MyVarSum") == F) {
      Stop = 1
    } else {
      ActualAICofx = sum(MyVar$varresult$x$residuals * MyVar$varresult$x$residuals) *
        exp(2 * (MyVar$varresult$x$rank + 1) / MyVar$obs)
      ActualAICofy = sum(MyVar$varresult$y$residuals * MyVar$varresult$y$residuals) *
        exp(2 * (MyVar$varresult$y$rank + 1) / MyVar$obs)
      if (p == 1) {
        LstAICx = ActualAICofx
        LstAICy = ActualAICofy
        Cinst = ""
        Cx = ""
        Cy = ""
      }
      
      if (ActualAICofy <= LstAICy) {
        LstAICy = ActualAICofy
        
        Mytest = causality(MyVar, cause = "x")
        if (Mytest$Granger$p.value[1] < 0.05) {
          if (Cx == "") {
            Cx = p
          } else  {
            Cx = paste(Cx, p, sep = ", ")
          }
          Cinst = Mytest$Instant$p.value[1]
        }
      }
      
      if (ActualAICofx <= LstAICx) {
        LstAICx = ActualAICofx
        Mytest = causality(MyVar, cause = "y")
        if (Mytest$Granger$p.value[1] < 0.05) {
          if (Cy == "") {
            Cy = p
          } else {
            Cy = paste(Cy, p, sep = ", ")
          }
          Cinst = Mytest$Instant$p.value[1]
        }
      }
    }
  }
  if (Cinst < 0.05) {
    if (Cx=="" & Cy=="") {
      GrangerOutput[i, 4] = ""
    } else {
      GrangerOutput[i, 4] = "van"
    }
    
  } else {
    GrangerOutput[i, 4] = ""
  }
  GrangerOutput[i, 1] = p-1
  GrangerOutput[i, 2] = Cx
  GrangerOutput[i, 3] = Cy
}
GrangerOutput = data.frame(NdiffInput, GrangerOutput)
names(GrangerOutput) = c("d","max p","x→y", "y→x", "x-y")
rownames(GrangerOutput) = names(d_input)


t5 <- kable(GrangerOutput, align =c("c","c","c","c"),caption = "5. táblázat. A teljes termékenységi arányszám és a vizsgált gazdasági-társadalmi változók közötti Granger-okság feltárására irányuló próbák eredménye") %>%
  kable_styling(bootstrap_options = "striped", full_width = T, fixed_thead = T)


y = c(NA, diff(head(
  LiveBirthAndFertility$LiveBirthTo1000, -1
)))
GrangerOutput = matrix(nrow = length(d_input), ncol = 4)
for (i in 1:length(d_input)) {
  x = data.frame(d_input[i], y)
  names(x) = c("x", "y")
  x = na.exclude(x)
  x = ts(x)
  p = 0
  Stop = 0
  while (Stop == 0) {
    p = p + 1
    if (p > 1) {
      remove(MyVar)
      remove(MyVarSum)
    }
    try({
      MyVar <- vars::VAR((x), p = p, type = "const")
      MyVarSum <- summary(MyVar)
    }
    , silent = T)
    if (exists("MyVarSum") == F) {
      Stop = 1
    } else {
      ActualAICofx = sum(MyVar$varresult$x$residuals * MyVar$varresult$x$residuals) *
        exp(2 * (MyVar$varresult$x$rank + 1) / MyVar$obs)
      ActualAICofy = sum(MyVar$varresult$y$residuals * MyVar$varresult$y$residuals) *
        exp(2 * (MyVar$varresult$y$rank + 1) / MyVar$obs)
      if (p == 1) {
        LstAICx = ActualAICofx
        LstAICy = ActualAICofy
        Cinst = ""
        Cx = ""
        Cy = ""
      }
      
      if (ActualAICofy <= LstAICy) {
        LstAICy = ActualAICofy
        
        Mytest = causality(MyVar, cause = "x")
        if (Mytest$Granger$p.value[1] < 0.05) {
          if (Cx == "") {
            Cx = p
          } else  {
            Cx = paste(Cx, p, sep = ", ")
          }
          Cinst = Mytest$Instant$p.value[1]
        }
      }
      
      if (ActualAICofx <= LstAICx) {
        LstAICx = ActualAICofx
        Mytest = causality(MyVar, cause = "y")
        if (Mytest$Granger$p.value[1] < 0.05) {
          if (Cy == "") {
            Cy = p
          } else {
            Cy = paste(Cy, p, sep = ", ")
          }
          Cinst = Mytest$Instant$p.value[1]
        }
      }
    }
  }
  if (Cinst < 0.05) {
    if (Cx=="" & Cy=="") {
      GrangerOutput[i, 4] = ""
    } else {
      GrangerOutput[i, 4] = "van"
    }
  } else {
    GrangerOutput[i, 4] = ""
  }
  GrangerOutput[i, 1] = p-1
  GrangerOutput[i, 2] = Cx
  GrangerOutput[i, 3] = Cy
}
GrangerOutput = data.frame(NdiffInput, GrangerOutput)
names(GrangerOutput) = c("d","max p","x→y", "y→x", "x-y")
rownames(GrangerOutput) = names(d_input)



t6 <- kable(GrangerOutput, align =c("c","c","c","c"),caption = "6. táblázat. Az ezer főre jutó éves születésszám és a vizsgált gazdasági-társadalmi változók közötti Granger-okság feltárására irányuló próbák eredménye") %>%
  kable_styling(bootstrap_options = "striped", full_width = T, fixed_thead = T)

y = c(NA, diff(head(
  LiveBirthAndFertility$LiveBirthTotal, -1
)))
GrangerOutput = matrix(nrow = length(d_input), ncol = 4)
for (i in 1:length(d_input)) {
  x = data.frame(d_input[i], y)
  names(x) = c("x", "y")
  x = na.exclude(x)
  x = ts(x)
  p = 0
  Stop = 0
  while (Stop == 0) {
    p = p + 1
    if (p > 1) {
      remove(MyVar)
      remove(MyVarSum)
    }
    try({
      MyVar <- vars::VAR((x), p = p, type = "const")
      MyVarSum <- summary(MyVar)
    }
    , silent = T)
    if (exists("MyVarSum") == F) {
      Stop = 1
    } else {
      ActualAICofx = sum(MyVar$varresult$x$residuals * MyVar$varresult$x$residuals) *
        exp(2 * (MyVar$varresult$x$rank + 1) / MyVar$obs)
      ActualAICofy = sum(MyVar$varresult$y$residuals * MyVar$varresult$y$residuals) *
        exp(2 * (MyVar$varresult$y$rank + 1) / MyVar$obs)
      if (p == 1) {
        LstAICx = ActualAICofx
        LstAICy = ActualAICofy
        Cinst = ""
        Cx = ""
        Cy = ""
      }
      
      if (ActualAICofy <= LstAICy) {
        LstAICy = ActualAICofy
        
        Mytest = causality(MyVar, cause = "x")
        if (Mytest$Granger$p.value[1] < 0.05) {
          if (Cx == "") {
            Cx = p
          } else  {
            Cx = paste(Cx, p, sep = ", ")
          }
          Cinst = Mytest$Instant$p.value[1]
        }
      }
      
      if (ActualAICofx <= LstAICx) {
        LstAICx = ActualAICofx
        Mytest = causality(MyVar, cause = "y")
        if (Mytest$Granger$p.value[1] < 0.05) {
          if (Cy == "") {
            Cy = p
          } else {
            Cy = paste(Cy, p, sep = ", ")
          }
          Cinst = Mytest$Instant$p.value[1]
        }
      }
    }
  }
  if (Cinst < 0.05) {
    if (Cx=="" & Cy=="") {
      GrangerOutput[i, 4] = ""
    } else {
      GrangerOutput[i, 4] = "van"
    }
    
  } else {
    GrangerOutput[i, 4] = ""
  }
  GrangerOutput[i, 1] = p-1
  GrangerOutput[i, 2] = Cx
  GrangerOutput[i, 3] = Cy
}
GrangerOutput = data.frame(NdiffInput, GrangerOutput)
names(GrangerOutput) = c("d","max p","x→y", "y→x", "x-y")
rownames(GrangerOutput) = names(d_input)

t7 <- kable(GrangerOutput, align =c("c","c","c","c"),caption = "7. táblázat. Az évenkénti születésszám és a vizsgált gazdasági-társadalmi változók közötti Granger-okság feltárására irányuló próbák eredménye") %>%
  kable_styling(bootstrap_options = "striped", full_width = T, fixed_thead = T)

df=data.frame(d_input$Activs,d_livebirthandfertility$LiveBirthTotal)
names(df)=c("Activs","LiveBirthTotal")
df=ts(df,start = 1960)
df=na.exclude(df)
MyVar=vars::VAR(df,p=18,type = "const")

df=select(data.frame(summary(MyVar)$varresult$Activs$coefficients),Estimate)
df=data.frame(df[seq(from=2, to=nrow(df), by=2),])
df["l"]=1:18
rownames(df)=NULL
df=df[c(2,1)]
names(df)=c("Késleltetések száma","Béta")
t8 <- kable(df, align = c("c","c"),
      caption="8. táblázat. Az aktívak számából (d=ld) és a teljes születésszámból a VAR(18) modellben aktívak számára becsült egyenletben szereplő születésszám késleltetett értékeihez tartozó koefficiensek értéke"
)

df=data.frame(d_input$Consumption,d_livebirthandfertility$LiveBirthTotal)
names(df)=c("Consumption","LiveBirthTotal")
df=ts(df,start = 1960)
df=na.exclude(df)
MyVar=vars::VAR(df,p=18,type = "const")
df1 <- data.frame(0:18,irf(MyVar, impulse = "Consumption", response = c("Consumption","LiveBirthTotal"),
                           n.ahead = 18, ortho = TRUE)$irf)
names(df1)=c("Lags","Consumption","LiveBirthTotal")
df2 <- df1
for (i in 2:nrow(df2)) {
  df2[i,2]= df1[i,2]+df2[i-1,2]
  df2[i,3]= df1[i,3]+df2[i-1,3]
}

df1=data.frame(c(rep("IRF",nrow(df1)),rep("CIRF",nrow(df1))),
               c(rep(df1$Lags,2)),
               c(df1$Consumption,rep(NA,nrow(df1))),
               c(df1$LiveBirthTotal,rep(NA,nrow(df1)))
)
names(df1)=c("place","Lags","Egy főre eső fogyasztás indexe (d=1)","Teljes születésszám (d=1)")

df1=gather(df1, key=variable, value=value, -c("Lags", "place"))

df1["valuemin"]=ifelse(as.numeric(df1$value)>=0,0,df1$value)
df1["valuemax"]=ifelse(as.numeric(df1$value)<=0,0,df1$value)


names(df2)=c("Lags","Egy főre eső fogyasztás indexe (d=1)","Teljes születésszám (d=1)")

df2["place"]=rep("CIRF",nrow(df2))
df2=gather(df2, key=variable, value=value, -c("Lags", "place"))

p12 <- ggplot(data=filter(df1,place=="IRF"),aes(x=Lags)) +
  geom_ribbon(aes(ymin=valuemin,ymax=valuemax, fill="IRF"), alpha = 0.4, color="#e3120b", size=1) +
  scale_fill_manual(values = c("IRF"="#e3120b")) +
  geom_line(data=df2, aes(x=Lags, y=value, color="CIRF"), size=2) +
  scale_color_manual(values = c("CIRF"="#244747")) +
  geom_hline(yintercept = 0) +
  facet_wrap(.~variable, scales = "free_y") +
  scale_x_continuous(expand = c(0,0)) +
  ylab("") + xlab("Sokk óta eltelt évek száma") +
  labs(title="12. ábra. A fogyasztás sokkjának születésszámban lecsapódó sokkja",
       subtitle = "Impulzus és kumulált impulzus válaszfüggvény"
  ) +
  MyTheme

df=data.frame(d_input$HouseholdDebt,d_livebirthandfertility$TotalFertility)
names(df)=c("HouseholdDebt","TotalFertility")

df=na.exclude(df)
df=ts(df)
MyVar=vars::VAR(df,p=4,type = "const")
p <- data.frame(0:5,irf(MyVar, impulse = "TotalFertility", response = c("HouseholdDebt","TotalFertility"),
                        n.ahead = 5, ortho = TRUE)$irf)

names(p)=c("t","2","1")
variable_names_p13 = list(
  "2" = "Háztartások adósságállománya\nrendelkezésre álló jövedelmük \nszázalékában (d=ld)",
  "1" = "Teljes termékenységi arányszám\n(d=1)"
)

variable_labeller_p13 <- function(variable, value) {
  return(variable_names_p13[value])
}
p = p %>% gather(key = "variable", value = "value", -t)

p13 <- ggplot(p, aes(t, value)) +
  geom_hline(yintercept=0, color="#244747" ,size=1) +
  geom_line(size = 1.5,color="#e3120b") +
  scale_x_discrete(expand = c(0, -1),limits=c(0:5)) +
  scale_y_continuous(expand = c(0.02,0.02)) +
  facet_wrap(~ variable, ncol = 2,labeller = variable_labeller_p13,scale="free") +
  labs(title = "13. ábra. A teljes termékenységi arányszámban bekövetkező sokk lecsapódása a háztartások adósságállományában",subtitle ="Impulzus válasz-függvény",caption="A VAR-modellben szereplő késleltetések száma: 4") +
  xlab("Sokkot követően eltelt évek száma") + ylab("") +
  theme_economist(dkpanel = T) + theme(
    legend.title = element_blank(),
    plot.title = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
    axis.title = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
    axis.ticks.length = unit(5, "points"),
    panel.grid.major = element_line(colour = "grey", 
                                    size = rel(1.75)),
    panel.spacing = unit(3, "lines")
  )

df=data.frame(year=1960:2017,head(LiveBirthAndFertility$TotalFertility,-1),Input$HouseholdDebt)
names(df)=c("year","TTA","HHD")
df=na.exclude(df)
l=3
df$HHD=c(
  rep(NA,l),
  df$HHD[l:nrow(df)-3]
)
df=na.exclude(df)

mean_df_HHD=mean(df$HHD)

p14 <- ggplot(data=df) +
  geom_hline(aes(yintercept = mean_df_HHD,linetype = "Átlag érték" ),size=1,color="black") +
  scale_linetype_manual(values= c("Átlag érték" = "dashed"))  +
  geom_vline(xintercept = mean(df$TTA),linetype = "dashed",size=1,color="black") +
  geom_point(aes(x=TTA, y=HHD),shape=21, fill="#8abbd0", color="#8abbd0",size=4,stroke=2, alpha = 0.7) +
  geom_abline(aes(color = "Analitikus regressziófüggvény", slope=lm(HHD~TTA, data=df)$coefficients[2], intercept =lm(HHD~TTA, data=df)$coefficients[1]), size=2) +
  annotate(
    geom = 'segment',
    y = Inf,
    yend = Inf,
    x = -Inf,
    xend = Inf,
    color="gray",
    size= 1.5
  ) +
  ylab("Háztartások adósságállománya 3 évvel később a rendelkezésre\nálló jövedelmük arányában (százalék)") +
  xlab("Teljes termékenységi arányszám") +
  labs(title = "14. ábra. A háztartások adósságállománya és a TTA közti kapcsolat",
       subtitle="A függőleges tengelyen a háztatások jövedelmének 3 évvel későbbi értéke szerepel"
  ) +
  scale_color_manual(values =c("Analitikus regressziófüggvény" = "#e3120b")) +
  theme_economist_white(gray_bg = F) + theme(
    axis.ticks.length = unit(5, "points"),
    axis.ticks.y  = element_line(colour = "gray", size=1.1),
    axis.ticks.length.y = unit(.3, "cm"),
    panel.grid.major = element_blank(),
    legend.title = element_blank(),
    plot.title = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
    axis.title = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
    legend.key.size = unit(3,"line")
  )

df <- df %>% select(TTA, HHD) # correlation
df
cor(df)
lm(HHD~TTA, data=df)

#Family benefits
df=data.frame(d_input$FamilyBenefits,d_livebirthandfertility$TotalFertility)
names(df)=c("FamilyBenefits","TTA")
df=ts(df,start = 1960)
df=na.exclude(df)
MyVar=vars::VAR(df,p=1,type = "const")

cat(paste("Családtámogatás előjele a modellben:" ,format(round(MyVar$varresult$TTA$coefficients[1], digits=2))))


df=data.frame(head(LiveBirthAndFertility$LiveBirthTo1000,-1),Input$Marriage)
names(df)=c("y","x")
v=ts(lm(y~x,df)$residuals)
ndiffs(v)

p15 <- ggplot() +
  geom_hline(yintercept = 0) +
  geom_line(aes(x=1960:2017, y=v), color="#1167a6", size=2) +
  scale_x_continuous(expand=c(0,0)) +
  xlab("Év") + ylab("") + labs(
    title="15. ábra. A születésszám az utóbbi években elmarad a házasságkötések számától",
    subtitle="Az ezer főre eső születésszámnak ezer főre eső házasságkötéssel magyarázott OLS reziduumai") +
  MyTheme


df=data.frame(d_input$UnemploymentT,d_livebirthandfertility$TotalFertility)
names(df)=c("UnemploymentT","TTA")
df=ts(df,start = 1960)
df=na.exclude(df)
MyVar=vars::VAR(df,p=5,type = "const")
p <- data.frame(0:10,irf(MyVar, impulse = "UnemploymentT", response = c("UnemploymentT","TTA"),
                         n.ahead = 10, ortho = TRUE)$irf)

names(p)=c("t","1","2")
variable_names_p16 = list("1" = "Munkanélküliségi ráta (d=ld)",
                      "2" = "Teljes termékenységi arányszám (d=1)")

variable_labeller_p16 <- function(variable, value) {
  return(variable_names_p16[value])
}
p = p %>% gather(key = "variable", value = "value", -t)
p16 <- ggplot(p, aes(t, value)) +
  geom_hline(yintercept=0, color="#244747" ,size=1) +
  geom_line(size = 1.5,color="#e3120b") +
  scale_x_discrete(expand = c(0, -1),limits=c(0:10)) +
  scale_y_continuous(expand = c(0.02,0.02)) +
  facet_wrap(~ variable, ncol = 1,labeller = variable_labeller_p16,scale="free") +
  labs(title = "16. ábra. Munkanélküliségben bekövetkező sokk lecsapódása",subtitle ="Impulzus válasz-függvény",caption="A VAR-modellben szereplő késleltetések száma: 5") +
  xlab("Sokkot követően eltelt évek száma") + ylab("") +
  theme_economist(dkpanel = T) + theme(
    legend.title = element_blank(),
    plot.title = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
    axis.title = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
    axis.ticks.length = unit(5, "points"),
    panel.grid.major = element_line(colour = "grey", 
                                    size = rel(1.75)),
    panel.spacing = unit(3, "lines")
  )


df=data.frame(Input$Year,d_input$Gini,d_livebirthandfertility$TotalFertility)
names(df)=c("Year","Gini","TTA")
df=na.exclude(df)
df=gather(df,key = "variable",value="value",-Year )

p17 <- ggplot(data=df) +
  geom_line(aes(x=Year, y=value, color=variable), size=1.5) +
  geom_point(aes(x=Year, y=value, color=variable), size=3)+
  scale_color_economist() +
  xlab("Év") + ylab("") + labs(title = "17. ábra. A Gini-mutató (d=ld) és a teljes termékenységi ráta (d=1) együttmozgása") + scale_x_continuous(expand=c(0,0)) +
  MyTheme

df=data.frame(d_input$CriminalTotal,d_livebirthandfertility$LiveBirthTotal)
names(df)=c("CriminalTotal","LiveBirthTotal")
df=na.exclude(df)
df=ts(df,start = 1965)
MyVar=vars::VAR(df,p=16,type = "const")
cat(
  paste(
    "A VAR(p=16) modell inverz gyökei:",
    paste0(format(round(vars::roots(MyVar),2)),
           collapse = ", "
    )
  )
)

df=data.frame(d_input$CriminalTotal,d_livebirthandfertility$LiveBirthTotal)
names(df)=c("CriminalTotal","LiveBirthTotal")
df=na.exclude(df)
df=ts(df,start = 1965)
MyVar=vars::VAR(df,p=12,type = "const")
cat(
  paste(
    "A VAR(p=12) modell inverz gyökei:",
    paste0(format(round(vars::roots(MyVar),2)),
           collapse = ", "
    )
  )
)

df=data.frame(d_input$CriminalTotal,d_livebirthandfertility$LiveBirthTotal)
names(df)=c("CriminalTotal","LiveBirthTotal")
df=na.exclude(df)
df=ts(df,start = 1965)
MyVar=vars::VAR(df,p=12,type = "const")
p <- data.frame(0:17,irf(MyVar, impulse = "CriminalTotal", response = c("CriminalTotal","LiveBirthTotal"),
                         n.ahead = 17, ortho = TRUE)$irf)

names(p)=c("t","1","2")
variable_names_p18 = list("1" = "Bűnelkövetők száma (d=1)",
                      "2" = "Évenkénti összes születésszám (d=1)")

variable_labeller_p18 <- function(variable, value) {
  return(variable_names_p18[value])
}
p = p %>% gather(key = "variable", value = "value", -t)

p18 <- ggplot(p, aes(t, value)) +
  geom_hline(yintercept=0, color="#244747" ,size=1) +
  geom_line(size = 1.5,color="#e3120b") +
  scale_x_discrete(expand = c(0, -1),limits=c(0:17)) +
  scale_y_continuous(expand = c(0.02,0.02)) +
  facet_wrap(~ variable, ncol = 1,labeller = variable_labeller_p18,scale="free") +
  labs(title = "18. ábra. Bűnelkövetők számában bekövetkező sokk lecsapódása",subtitle ="Impulzus válasz-függvény",caption="A VAR-modellben szereplő késleltetések száma: 12") +
  xlab("Sokkot követően eltelt évek száma") + ylab("") +
  theme_economist(dkpanel = T) + theme(
    legend.title = element_blank(),
    plot.title = element_text(margin = margin(t = 0, r = 0, b = 10, l = 0)),
    axis.title = element_text(margin = margin(t = 10, r = 10, b = 0, l = 0)),
    axis.ticks.length = unit(5, "points"),
    panel.grid.major = element_line(colour = "grey", 
                                    size = rel(1.75)),
    panel.spacing = unit(3, "lines")
  )
metadata_final_pooled <- tibble::tribble(
  ~Változó.neve,    ~Hivatkozott.név,                             ~Mértékegység, ~Megfigyelt.évek,
  "Termékenységi ráta",               "TTA",                              "Gyermek/Nő",      "1960-2018",
  "Évenkénti összes születésszám",    "LiveBirthTotal",                                      "Fő",      "1960-2018",
  "Ezer főre eső évenkénti születésszám",   "LiveBirthTo1000",                        "1000 főre eső db",      "1960-2018",
  "Alkalmazásban állók havi bruttó átlagkeresete a nemzetgazdaságban",       "NominalWage",                                      "Ft",      "1960-2017",
  "Gazdaságilag aktív népesség száma, január 1-én",            "Activs",                                 "Ezer fő",      "1960-2017",
  "Egy keresőre jutó reálkereset indexe, 1960 = 100%",        "RealIncome",                                "Százalék",      "1960-2017",
  "Házasságkötés (ezer lakosra)",          "Marriage",                        "1000 főre eső db",      "1960-2017",
  "Egy főre eső fogyasztás indexe",       "Consumption",                                "Százalék",      "1960-2017",
  "Bűncselekmények száma",             "Crime",                                   "Darab",      "1965-2017",
  "Bűnelkövetők száma (fiatalkorú)",     "CriminalYoung",                                      "Fő",      "1965-2017",
  "Bűnelkövetők száma (felnőtt)",     "CriminalAdult",                                      "Fő",      "1965-2017",
  "Bűnelkövetők száma (összesen)",     "CriminalTotal",                                      "Fő",      "1965-2017",
  "Bruttó nemzeti kibocsátás bázisindexe, 1960 = 100%",           "GDP1960",                                "Százalék",      "1960-2017",
  "Egy főre jutó bruttó nemzeti kibocsátás bázisindexe, 1960 = 100%",        "GDPCAP1960",                                "Százalék",      "1960-2017",
  "Anyagi deprivációban élők aránya lakhatás tekintetében",     "MDeprivationT",                                "Százalék",      "2005-2017",
  "18 év alatti anyagi deprivációban élők aránya lakhatás tekintetében",   "MDeprivation018",                                "Százalék",      "2005-2017",
  "18 és 65 éves kor közötti anyagi deprivációban élők aránya lakhatás tekintetében",  "MDeprivation1865",                                "Százalék",      "2005-2017",
  "Teljes termékenységi ráta országonként",    "FertilityRates",                              "Gyermek/Nő",      "1960-2017",
  "Megtakarítási ráta",            "Saving",                           "GDP százaléka",      "1995-2017",
  "Háztartások adóság állománya",     "HouseholdDebt", "Rendelkezésre álló  jövedelem százaléka",      "1995-2017",
  "Gini mutató",              "Gini",                   "0 és 1 közötti mutató",      "2006-2016",
  "90/10 mutató",            "P90P10",                                   "Arány",      "2006-2016",
  "Relatív szegénységi ráta a 0-17 éves lakosság körében",    "PovertyRate017",                                   "Arány",      "2006-2016",
  "Relatív szegénységi ráta a 18-65 éves lakosság körében",   "PovertyRate1865",                                   "Arány",      "2006-2016",
  "Relatív szegénységi ráta a 66 évesnél idősebb lakosság körében",     "PovertyRate66",                                   "Arány",      "2006-2016",
  "Relatív szegénységi ráta a teljes lakosság körében",    "PovertyRateTot",                                   "Arány",      "2006-2016",
  "Munkanélküliségi ráta a férfi népesség körében",     "UnemploymentM",                                "Százalék",      "1999-2017",
  "Munkanélküliségi ráta a női népesség körében",     "UnemploymentW",                                "Százalék",      "1999-2017",
  "Munkanélküliségi ráta a teljes népesség körében",     "UnemploymentT",                                "Százalék",      "1999-2017",
  "1000 főre eső császármetszések száma", "CaesareanSections",                        "1000 főre eső db",      "2004-2017",
  "Állam által fizetett nyugdíjak mértéke a GDP százalékában",     "PensionPublic",                                "Százalék",      "1999-2015",
  "Állami családtámogatás mértéke a GDP százalékában",    "FamilyBenefits",                                "Százalék",      "1999-2015"
) %>% data.frame()

F1 <- metadata_final_pooled %>% head(14)
names(F1) <- c("Változó neve",	"Hivatkozott név","	Mértékegység",	"Megfigyelt évek")
F1 <- F1 %>% kable(caption = "F1. Központi Statisztika Hivatal oldaláról származó adatok (letöltés dátuma: 2020. 02. 01)", align = c("l",rep("c",3))) %>%
               kable_styling(bootstrap_options = "striped",full_width = T, fixed_thead = T)

F2 <- metadata_final_pooled %>% head(17) %>% tail(3)
names(F2) <- c("Változó neve",	"Hivatkozott név","	Mértékegység",	"Megfigyelt évek")
F2 <- F2 %>% kable(caption = "F2. Eurostat oldaláról származó adatok (letöltés dátuma: 2020. 03. 01)", align = c("l",rep("c",3))) %>%
  kable_styling(bootstrap_options = "striped",full_width = T, fixed_thead = T)

F3 <- metadata_final_pooled %>%  tail(-17)
names(F3) <- c("Változó neve",	"Hivatkozott név","	Mértékegység",	"Megfigyelt évek")
F3 <- F3 %>% kable(caption = "F3. OECD oldaláról származó adatok (letöltés dátuma: 2020. 01. 04)", align = c("l",rep("c",3))) %>%
  kable_styling(bootstrap_options = "striped",full_width = T, fixed_thead = T)

CountryData <- tibble::tribble(
  ~country, ~code2, ~code3,  ~longitude,  ~latitude,                   ~magyarul,
  "Argentina",   "AR",  "ARG",  -63.616672, -38.416097,                 "Argentina",
  "Australia",   "AU",  "AUS",  133.775136, -25.274398,                "Ausztrália",
  "Austria",   "AT",  "AUT",   14.550072,  47.516231,                  "Ausztria",
  "Belgium",   "BE",  "BEL",    4.469936,  50.503887,                   "Belgium",
  "Brazil",   "BR",  "BRA",   -51.92528, -14.235004,                  "Brazília",
  "Bulgaria",   "BG",  "BGR",    25.48583,  42.733883,                  "Bulgária",
  "Canada",   "CA",  "CAN", -106.346771,  56.130366,                    "Kanada",
  "Chile",   "CL",  "CHL",  -71.542969, -35.675147,                     "Chile",
  "China",   "CN",  "CHN",  104.195397,   35.86166,                      "Kína",
  "Colombia",   "CO",  "COL",  -74.297333,   4.570868,                          NA,
  "Costa Rica",   "CR",  "CRI",  -83.753428,   9.748917,                "Costa Rica",
  "Croatia",   "HR",  "HRV",        15.2,  45.099998,              "Horvátország",
  "Cyprus",   "CY",  "CYP",   33.429859,  35.126413,                    "Ciprus",
  "Czech Republic",   "CZ",  "CZE",   15.472962,  49.817492,                "Csehország",
  "Denmark",   "DK",  "DNK",    9.501785,   56.26392,                     "Dánia",
  "Estonia",   "EE",  "EST",   25.013607,  58.595272,                "Észtország",
  "Finland",   "FI",  "FIN",   25.748151,   61.92411,                "Finnország",
  "France",   "FR",  "FRA",    2.213749,  46.227638,             "Franciaország",
  "Germany",   "DE",  "DEU",   10.451526,  51.165691,               "Németország",
  "Greece",   "GR",  "GRC",   21.824312,  39.074208,               "Görögország",
  "Hungary",   "HU",  "HUN",   19.503304,  47.162494,              "Magyarország",
  "Iceland",   "IS",  "ISL",  -19.020835,  64.963051,                    "Izland",
  "India",   "IN",  "IND",    78.96288,  20.593684,                     "India",
  "Indonesia",   "ID",  "IDN",  113.921327,  -0.789275,                 "Indonézia",
  "Ireland",   "IE",  "IRL",    -8.24389,   53.41291,                          NA,
  "Israel",   "IL",  "ISR",   34.851612,  31.046051,                    "Izrael",
  "Italy",   "IT",  "ITA",    12.56738,   41.87194,               "Olaszország",
  "Japan",   "JP",  "JPN",  138.252924,  36.204824,                     "Japán",
  "Latvia",   "LV",  "LVA",   24.603189,  56.879635,                "Lettország",
  "Lithuania",   "LT",  "LTU",   23.881275,  55.169438,                  "Litvánia",
  "Luxembourg",   "LU",  "LUX",    6.129583,  49.815273,                 "Luxemburg",
  "Malta",   "MT",  "MLT",   14.375416,  35.937496,                     "Málta",
  "Mexico",   "MX",  "MEX", -102.552784,  23.634501,                    "Mexikó",
  "Netherlands",   "NL",  "NLD",    5.291266,  52.132633,                 "Hollandia",
  "New Zealand",   "NZ",  "NZL",  174.885971, -40.900557,                 "Új-Zéland",
  "Norway",   "NO",  "NOR",    8.468946,  60.472024,                  "Norvégia",
  "Peru",   "PE",  "PER",  -75.015152,  -9.189967,                      "Peru",
  "Poland",   "PL",  "POL",   19.145136,  51.919438,             "Lengyelország",
  "Portugal",   "PT",  "PRT",   -8.224454,  39.399872,                "Portugália",
  "Romania",   "RO",  "ROU",    24.96676,  45.943161,                   "Románia",
  "Russia",   "RU",  "RUS",  105.318756,   61.52401,               "Oroszország",
  "Saudi Arabia",   "SA",  "SAU",   45.079162,  23.885942,              "Szaúd-Arábia",
  "Slovakia",   "SK",  "SVK",   19.699024,  48.669026,                 "Szlovákia",
  "Slovenia",   "SI",  "SVN",   14.995463,  46.151241,                 "Szlovénia",
  "South Africa",   "ZA",  "ZAF",   22.937506, -30.559482,    "Dél-afrikai Közársaság",
  "South Korea",   "KR",  "KOR",  127.766922,  35.907757,        "Koreai Köztársaság",
  "Spain",   "ES",  "ESP",    -3.74922,  40.463667,             "Spanyolország",
  "Sweden",   "SE",  "SWE",   18.643501,  60.128161,                "Svédország",
  "Switzerland",   "CH",  "CHE",    8.227512,  46.818188,                     "Svájc",
  "Turkey",   "TR",  "TUR",   35.243322,  38.963745,               "Törökország",
  "United Kingdom",   "GB",  "GBR",   -3.435973,  55.378051,            "Nagy-Britannia",
  "United States",   "US",  "USA",  -95.712891,   37.09024, "Amerikai Egyesült Államok"
) %>% data.frame()


NeighbourCountry2 <- NeighbourCountry

#----

df <- CountryData %>% filter(code3 %in% names(NeighbourCountry2))
df <- df %>% mutate(id=seq(nrow(df))) %>% select(id, code3, longitude, latitude)
names(df) <- c('id','name', 'lon', 'lat')
nodes <- df

###

df <- NeighbourCountry2

df <- apply(df, 2, function(x) {ifelse(x==1,names(NeighbourCountry2[i]),NA)}) %>% 
  data.frame() %>% 
  mutate(x=names(df)) %>% 
  gather(key=key, value=value,-x) %>% 
  filter(!is.na(value)) %>% select(key, x)
names(df)=c("key", "name")
df <- df %>% left_join(nodes) %>% select(key, name, lon, lat)
names(df)=c("name", "key", "x", "y")
df <- df %>% left_join(nodes) %>% select(key, name,x, y, lon, lat)
names(df)=c("name", "key", "x", "y", "xend", "yend")
df <- df %>% mutate(du=rep(0,nrow(df)))
for (i in 2:nrow(df)) {
  df[i,7]<- df[1:(i-1),] %>% filter(key==df[i,1], name==df[i,2]) %>% nrow()
}
edges_for_plot <- df %>% filter(du==0) %>% select(name, key, x, y, xend, yend)


maptheme <- theme(panel.grid = element_blank()) +
  theme(axis.text = element_blank()) +
  theme(axis.ticks = element_blank()) +
  theme(axis.title = element_blank()) +
  theme(legend.position = "bottom") +
  theme(panel.grid = element_blank()) +
  theme(panel.background = element_rect(fill = "#596673")) +
  theme(plot.margin = unit(c(0, 0, 0.5, 0), 'cm'))

country_shapes <- geom_polygon(aes(x = long, y = lat, group = group),
                               data = map_data('world'),
                               fill = "#CECECE", color = "#515151",
                               size = 0.15)
mapcoords <- coord_fixed(xlim = c(-150, 180), ylim = c(-55, 80))

F4 <- ggplot(nodes) + country_shapes +
  geom_curve(aes(x = x, y = y, xend = xend, yend = yend,     # draw edges as arcs
                 color = "red"),size = 2,
             data = edges_for_plot, curvature = 0.33,
             alpha = 0.5) +
  geom_text(aes(x = lon, y = lat, label = name),             # draw text labels
            hjust = 0.7, nudge_x = 0, nudge_y = 0,
            size = 2, color = "black", fontface = "bold") +
  labs(title = "A számítások során egymás szomszédjainak tekintett országok") +
  mapcoords + theme_void() + theme(
    panel.background = element_rect(fill = "#acc8d4"),
    legend.position = "none",
    plot.margin = unit(c(0.1,0.1,0.1,0.1), 'cm')
  )